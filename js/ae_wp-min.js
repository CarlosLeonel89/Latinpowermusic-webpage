function AEJSReady(e){if(AEJSWP.debugOutput("AEJSReady fired"),AEJSWP.detect_safari_incognito()?AEJSWP.display_browser_config_error("safari_incognito"):AEJSWP.detect_cookies_enabled()||AEJSWP.display_browser_config_error("cookies_disabled"),void 0!==AEJSWP.ae_framework_reloaded&&AEJSWP.ae_framework_reloaded)return AEJSWP.debugOutput("But not re-running AEJSReady init as this is a framework reload, instead starting auth flow with provider = "+AEJSWP.auth_service_after_reload),void AEJSWP.aeJS.trigger.authenticate(AEJSWP.auth_service_after_reload,"register");if(AEJSWP.aeJS=e,e.events.onFlow.addHandler(AEJSWP.flowHandler),e.events.onLogin.addHandler(AEJSWP.loginHandler),e.events.onLogout.addHandler(AEJSWP.logoutHandler),e.events.onUser.addHandler(AEJSWP.userHandler),e.events.onWindow.addHandler(AEJSWP.windowHandler),e.events.onMobileDetect.addHandler(AEJSWP.mobileDetectHandler),e.events.onEmailVerify.addHandler(AEJSWP.emailVerifyHandler),e.events.onPasswordReset.addHandler(AEJSWP.passwordResetHandler),"detect"==AEJSWP.flow_type?(e.settings.mobile_detect=!0,e.settings.auth_window=!0):e.settings.auth_window="modal"==AEJSWP.flow_type,e.settings.extra_fields_screen=AEJSWP.extra_fields_screen,e.settings.extra_fields=AEJSWP.extra_fields,e.settings.minimum_age=AEJSWP.minimum_age?AEJSWP.minimum_age:null,e.settings.services=AEJSWP.services,e.settings.flow_css=""!=AEJSWP.flow_css?AEJSWP.flow_css:null,e.settings.verify_email=!!AEJSWP.verify_email,e.settings.verify_email_for_login=!!AEJSWP.verify_email,e.settings.flow_text=AEJSWP.flow_text,e.settings.no_email=!!AEJSWP.no_email,e.settings.hide_email_form=!!AEJSWP.hide_email_form,e.settings.social_first=!!AEJSWP.social_first,e.settings.return_url=AEJSWP.return_url,e.settings.email_format=AEJSWP.email_format,e.settings.date_format=AEJSWP.date_format,e.settings.sso=AEJSWP.sso_type,""!=AEJSWP.extra_info&&(e.settings.extra_info=AEJSWP.extra_info),void 0!==AEJSWP.validation_target&&""!=AEJSWP.validation_target)if("widget"!=AEJSWP.validation_target){var t=parseInt(AEJSWP.validation_target.replace("cform-",""));AEJSWP.debugOutput("Validation Target is custom form "+t),AEJSWP.applyCustomFormSettings(t)}else AEJSWP.debugOutput("Validation Target is widget");else AEJSWP.debugOutput("Validation Target not defined, assuming widget"),AEJSWP.validation_target;AEJSWP.user_logging_in=!1,AEJSWP.ae_login_fired=!1,AEJSWP.custom_form_complete=!1,AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed")||AEJSWP.setLocalStorageItem("aeswp_cform_mailing_lists_completed",[],!0),AEJSWP.setOptinChoicesSessionStorage(),AEJSWP.debugOutput("",AEJSWP),AEJSWP.debugOutput("AEJSReady: ",e),AEJSWP.getLocalStorageItem("aejswp_cform_id")&&(AEJSWP.debugOutput("Custom Form flow still in progress"),AEJSWP.applyCustomFormSettings(AEJSWP.getLocalStorageItem("aejswp_cform_id")));for(var r=0;r<AEJSWP.aejsready_handlers.length;r++)AEJSWP.debugOutput("Calling custom aejsready_handler : "+AEJSWP.aejsready_handlers[r]),AEJSWP.executeFunctionByName(AEJSWP.aejsready_handlers[r],window,e)}AEJSWP.updateCustomForms_afterWaitForAeJS=function(){void 0!==AEJSWP.aeJS?(AEJSWP.updateCustomForms(),AEJSWP.aeJS.trigger.attach()):(AEJSWP.wait_for_aejs_retry_count++,AEJSWP.wait_for_aejs_retry_count>600?console.log("AEJSWP: Giving up waiting for aeJS after 1 minute - something is broke"):setTimeout(AEJSWP.updateCustomForms_afterWaitForAeJS,100))},jQuery(document).ready((function(){AEJSWP.redirectFlowSigninErrorCheck(),AEJSWP.addAuthenticatorClickHandler(),void 0!==AEJSWP.aeJS&&AEJSWP.authConnect(AEJSWP.aeJS.user),AEJSWP.addCustomFormListeners(),void 0!==AEJSWP.aeJS&&AEJSWP.aeJS.trigger.attach(),AEJSWP.wait_for_aejs_retry_count=0,AEJSWP.updateCustomForms_afterWaitForAeJS(),jQuery(".ae-cform-container:not(.-has-modal)").each((function(){var e=jQuery(".ae-cform-optin-terms a, .ae-cform-optins-container .ae-cform-optin-label",jQuery(this));AEJSWP.setAutoColors(e)}));for(const e in AEJSWP.custom_forms)"object"==typeof AEJSWP.custom_forms[e]&&(AEJSWP.custom_forms[e].selectors=[],jQuery(".ae-cform-container,.ae-cform-modal-container").each(((t,r)=>void 0!==jQuery(r).data("hash-selector")?AEJSWP.custom_forms[e].selectors.push(jQuery(r).data("hash-selector")):null)))})),AEJSWP.setOptinChoicesSessionStorage=function(){var e=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);AEJSWP.getLocalStorageItem("aejswp_optin_choices")?AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0)||AEJSWP.setSessionStorageItem("aejswp_initial_optin_choices",e,!0):AEJSWP.setLocalStorageItem("aejswp_optin_choices",[],!0),AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0)||AEJSWP.setSessionStorageItem("aejswp_initial_optin_choices",[],!0)},AEJSWP.reloadAeJSFramework=function(e){if(AEJSWP.aeJS.settings.auth_window)AEJSWP.debugOutput("Starting auth flow with provider = "+e),AEJSWP.aeJS.trigger.authenticate(e,"register");else{AEJSWP.debugOutput("Redirect flow, so re-loading aeJS framework to pick up changed settings");var t=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=AEJSWP.ae_js_path,t.appendChild(r),AEJSWP.ae_framework_reloaded=!0,AEJSWP.auth_service_after_reload=e}},AEJSWP.userHandler=function(e,t){if(AEJSWP.debugOutput("userHandler: "+t,e),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.debugOutput("Doing nothing, password reset flow in progress");else if("disabled"!=AEJSWP.sso_type||AEJSWP.getSessionStorageItem("aejswp_ae_login_fired")){if(void 0!==e&&void 0!==e.data){if(AEJSWP.onUserSSOLogin())return AEJSWP.debugOutput("onUser SSO attempt"),void AEJSWP.loginHandler(e,"login",!0);if(AEJSWP.getLocalStorageItem("aejswp_cform_id"))return void("init"!=t&&"update"!=t||AEJSWP.customFormValidation(e));AEJSWP.disable_logged_in_session&&(AEJSWP.debugOutput("Logged-in session disabled in performance settings"),AEJSWP.ajaxUpdateState(e)),AEJSWP.authConnect(e)}}else void 0!==e&&void 0!==e.data&&AEJSWP.authConnect(e)},AEJSWP.loginHandler=function(e,t,r){if(AEJSWP.debugOutput("loginHandler: "+t+" (sso="+r+")",e),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.debugOutput("Doing nothing, password reset flow in progress");else if(AEJSWP.setSessionStorageItem("aejswp_ae_login_fired",!0),AEJSWP.ae_login_fired=!0,"registration"==t&&AEJSWP.trackEvent("registration",e),"auth"==t&&(AEJSWP.trackEvent("accountConnect",e),AEJSWP.authConnect(e)),!AEJSWP.custom_form_complete){if(AEJSWP.getLocalStorageItem("aejswp_cform_id")&&("login"==t||"registration"==t))return void AEJSWP.customFormValidation(e);("login"==t||"registration"==t||"auth"==t&&!AEJSWP.user_logged_in)&&AEJSWP.logUserIn(e)}},AEJSWP.flowHandler=function(e){if(AEJSWP.debugOutput("flowHandler: ",e),void 0!==e.step)if(AEJSWP.getLocalStorageItem("aejswp_cform_id")){AEJSWP.ae_form_submit_in_progress=!1;var t=AEJSWP.getLocalStorageItem("aejswp_cform_id");if("verify-email"==e.step&&(AEJSWP.debugOutput("User still needs to verify their email"),AEJSWP.setSessionStorageItem("aejswp_verify_email_in_progress",AEJSWP.aeJS.user.data.Email),AEJSWP.displayVerifyEmail(t,AEJSWP.aeJS.user.data.Email),AEJSWP.getSessionStorageItem("aejswp_verify_email_sent")||(AEJSWP.setSessionStorageItem("aejswp_verify_email_sent",!0),AEJSWP.sendVerifyEmail(AEJSWP.aeJS.user.data.Email))),"required-fields"==e.step)if(AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.debugOutput("User still in password reset flow - so not showing additional details form, they must login first");else{AEJSWP.debugOutput("User missing required fields"),AEJSWP.addAEHandlerBackToCustomForm(AEJSWP.getLocalStorageItem("aejswp_cform_id")),AEJSWP.hideCaptchaOnForm(AEJSWP.getLocalStorageItem("aejswp_cform_id")),AEJSWP.redirectToCustomFormPage(t);var r=AEJSWP.checkUserRequiredFields(t,AEJSWP.aeJS.user);AEJSWP.displayAdditionalDetailsForm(t,r),AEJSWP.updateCustomForms()}if("error"===e.step){var a;if(e.error=e.error.replace(/\+/g," "),e.error=e.error.replace(/\%2F/g,"/"),e.error.includes("Email account already exists with a different password"))if(AEJSWP.debugOutput("That user already exists - please use the login form instead"),(a=jQuery("#ae-cform-email-reg-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"))).length&&AEJSWP.setFormError(a,AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].flow_labels.form_error_account_exists),!AEJSWP.aeJS.settings.auth_window){t=AEJSWP.getLocalStorageItem("aejswp_cform_id");AEJSWP.displayRegistrationForm(t),jQuery("#ae-cform-email-container-"+t).slideToggle()}if(e.error.includes("No account exists with those credentials"))AEJSWP.debugOutput("Incorrect email and/or password"),(a=jQuery("#ae-cform-email-login-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"))).length&&AEJSWP.setFormError(a,AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].flow_labels.form_error_no_account),AEJSWP.aeJS.settings.auth_window||jQuery("#ae-cform-email-container-"+AEJSWP.getLocalStorageItem("aejswp_cform_id")).slideToggle();if(e.error.includes("Missing required username and/or password"))AEJSWP.debugOutput("Missing required username and/or password"),(a=jQuery("#ae-cform-email-login-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"))).length&&AEJSWP.setFormError(a,AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].flow_labels.form_error_no_account),AEJSWP.aeJS.settings.auth_window||jQuery("#ae-cform-email-container-"+AEJSWP.getLocalStorageItem("aejswp_cform_id")).slideToggle();e.error.includes("authentication denied")&&AEJSWP.debugOutput("Social Auth denied")}}else"register"==e.step&&AEJSWP.trackEvent("registrationModalShown",AEJSWP.widget_cta),"login"==e.step&&AEJSWP.trackEvent("loginModalShown",AEJSWP.widget_cta)},AEJSWP.emailVerifyHandler=function(e,t){if(AEJSWP.debugOutput("emailVerifyHandler: "+e,t),""!=AEJSWP.getQueryStringValue("password_reset")&&AEJSWP.setSessionStorageItem("aejswp_cform_id",parseInt(AEJSWP.getQueryStringValue("password_reset"))),AEJSWP.getLocalStorageItem("aejswp_cform_id")&&void 0!==e){var r;if("sent"==e)if(AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.displayPasswordResetEmailSent(),(r=jQuery("#ae-cform-reset-password-step1-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"))).length&&AEJSWP.hideFormError(r),AEJSWP.clearPasswordResetState();if("verified"==e&&(AEJSWP.debugOutput("User returned after succesful email verification"),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))){AEJSWP.debugOutput("Storing verify email return data for password reset"),AEJSWP.setSessionStorageItem("aejswp_password_reset_email",t.EmailAddress),AEJSWP.setSessionStorageItem("aejswp_password_reset_member_service_id",t.MemberServiceID),1==parseInt(AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].modal_display)&&AEJSWP.setSessionStorageItem("aejswp_password_reset_force_modal_open",!0),AEJSWP.debugOutput("Logging user out of their AE session, to stop stop SSO login on page refresh"),AEJSWP.aeJS.trigger.logout();var a=AEJSWP.removeURLParameter(window.location.href,"password_reset");a=AEJSWP.removeURLParameter(a,"step"),a=AEJSWP.removeURLParameter(a,"code"),window.location.href=a}if("error"==e&&void 0!==t.code&&169==t.code)AEJSWP.debugOutput("Users password reset email is invalid"),(r=jQuery("#ae-cform-reset-password-step1-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"))).length&&AEJSWP.setFormError(r,AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].flow_labels.form_error_email_not_found)}},AEJSWP.passwordResetHandler=function(e,t){AEJSWP.debugOutput("passwordResetHandler: "+e,t),AEJSWP.getLocalStorageItem("aejswp_cform_id")&&void 0!==e&&"ok"==e&&(AEJSWP.displayPasswordResetSuccess(),AEJSWP.clearPasswordResetState(),AEJSWP.debugOutput("Logging user out of their AE session, in readyness for a fresh login after password reset"),AEJSWP.aeJS.trigger.logout())},AEJSWP.mobileDetectHandler=function(){AEJSWP.debugOutput("mobileDetectHandler fired"),AEJSWP.aeJS.settings.auth_window=!1},AEJSWP.windowHandler=function(e){AEJSWP.debugOutput("windowHandler: ",e)},AEJSWP.logoutHandler=function(e){AEJSWP.debugOutput("logoutHandler: ",e)},AEJSWP.incognitoHandler=function(e,t){AEJSWP.detect_safari_incognito()||!AEJSWP.detect_cookies_enabled()?(e.stopImmediatePropagation(),jQuery("body").append('<div id="ae-browser-config-error" style="display:none;">'+(AEJSWP.detect_safari_incognito()?AEJSWP.safari_incognito_error:AEJSWP.cookies_disabled_error)+"</div>"),jQuery("#ae-browser-config-error").modal()):"ae-widget"==t&&AEJSWP.trackEvent("registrationModalShown",AEJSWP.widget_cta)},AEJSWP.logUserIn=function(e,t){if(t=t||!1,!AEJSWP.user_logging_in){AEJSWP.user_logging_in=!0,AEJSWP.debugOutput("User logged in to AE, performing WP plugin follow on actions..."),AEJSWP.trackEvent("login",e);var r=AEJSWP.getQueryStringValue("aewperror");if(""==r)if(AEJSWP.user_logged_in)AEJSWP.debugOutput("Doing nothing, user already logged-in");else if(AEJSWP.ajax_login){var a=t?AEJSWP.getUserOptinChoices(t):[];AEJSWP.ajaxLogin(e,a,t)}else{if(AEJSWP.disable_wp_user_record)return AEJSWP.debugOutput("WP user record disabled"),t&&AEJSWP.sendUserOptins(t,e.data,AEJSWP.getUserOptinChoices(t)),void AEJSWP.ajaxUpdateState(e);if(AEJSWP.disable_logged_in_session&&(AEJSWP.debugOutput("Logged-in session disabled"),!AEJSWP.aeJS.settings.auth_window&&!t))return void AEJSWP.debugOutput("User has already been through redirect login handler, which will have created the WP record, doing nothing");AEJSWP.maybe_wait_for_event("send_user_optins",(function(){var r=t?AEJSWP.getUserOptinChoices(t):[],a=AEJSWP.getUserUpdatedOptins(t,r);if(a){e.data=AEJSWP.run_filter("filter__optin_user_data",e.data);var o={cform_id:t,user_data:e.data,optins:a};AEJSWP.trackEvent("optinsUpdated",o)}AEJSWP.redirectLogin(e,r,t)}))}else AEJSWP.debugOutput("Doing nothing, aewperror="+r+" detected in query string")}},AEJSWP.ajaxLogin=function(e,t,r){void 0===e.services&&(e.services=[]),r=r||!1;var a=window.location.href;a=AEJSWP.removeURLParameter(a,"password_reset"),AEJSWP.maybe_wait_for_event("send_user_optins",(function(){var t=AEJSWP.run_filter("filter__optin_user_data",e.data),o=o||[],i={action:AEJSWP.ajax_action_login,data:t,services:e.services,current_page:a,optins:o,cform_id:r};AEJSWP.disable_wp_user_record?(AEJSWP.debugOutput("WP user record disabled, not making AJAX request to login"),r&&AEJSWP.sendUserOptins(r,t,AEJSWP.getUserOptinChoices(r)),""!=AEJSWP.login_redirect_url?(AEJSWP.debugOutput("Post login redirect specified, redirecting to: "+AEJSWP.login_redirect_url),window.location.href=AEJSWP.login_redirect_url):(AEJSWP.debugOutput("Updating state via AJAX"),AEJSWP.ajaxUpdateState(e))):(AEJSWP.debugOutput("WP Login AJAX request : ",i),jQuery.post(AEJSWP.ajaxurl,i,(function(t){try{if(0==(t=jQuery.parseJSON(t)).status)6==t.fail_status&&(t.message=t.message.replace(new RegExp("<br/>","g"),"\n"),alert(t.message)),console.log("AEJSWP Error: WP Login AJAX response : ",t);else{AEJSWP.debugOutput("WP Login AJAX response : ",t);var a=AEJSWP.getUserUpdatedOptins(r,o);if(a){var i={cform_id:r,user_data:e.data,optins:a};AEJSWP.trackEvent("optinsUpdated",i)}""!=AEJSWP.login_redirect_url?(AEJSWP.debugOutput("Post login redirect specified, redirecting to: "+AEJSWP.login_redirect_url),window.location.href=AEJSWP.login_redirect_url):(AEJSWP.debugOutput("Updating state via AJAX"),AEJSWP.ajaxUpdateState(e),AEJSWP.disable_logged_in_session||(AEJSWP.debugOutput("Setting user_logged_in to true & making AJAX request to get an updated logout URL"),AEJSWP.user_logged_in=!0,AEJSWP.getLogoutURL()),AEJSWP.authConnect(e))}}catch(e){console.log("AEJSWP Error: WP Login AJAX response : ",t)}})))}))},AEJSWP.redirectLogin=function(e,t,r){var a=e.data.AccessToken,o=(t=t||[],encodeURIComponent(JSON.stringify(t))),i=window.location.href;i=AEJSWP.removeURLParameter(i,"accessToken"),i=AEJSWP.removeURLParameter(i,"password_reset");var s=""!=AEJSWP.login_redirect_url?AEJSWP.login_redirect_url:i;s=AEJSWP.run_filter("filter__redirect_login_return_url",s),s=encodeURIComponent(s);var n=AEJSWP.ajaxurl+"?action="+AEJSWP.redirect_action_login+"&accessToken="+a+"&optins="+o+"&cform_id="+r+"&return_url="+s;void 0!==AEJSWP.custom_forms[r]&&void 0!==AEJSWP.custom_forms[r].block_login_redirect&&AEJSWP.custom_forms[r].block_login_redirect?(AEJSWP.debugOutput("Blocked Redirect Login, holding redirect URL: "+n),AEJSWP.paused_redirect_url=n):(AEJSWP.debugOutput("Redirect Login, redirecting to: "+n),window.location.href=n)},AEJSWP.getLogoutURL=function(){var e={action:AEJSWP.ajax_action_get_logout_url,return_url:window.location.href};AEJSWP.debugOutput("WP get_logout_url AJAX request",e),jQuery.post(AEJSWP.ajaxurl,e,(function(e){AEJSWP.debugOutput("WP get_logout_url AJAX response : ",e),""!=(e=jQuery.parseJSON(e)).wp_logout_url&&(AEJSWP.wp_logout_url=e.wp_logout_url)}))},AEJSWP.onUserSSOLogin=function(){var e=AEJSWP.getSessionStorageItem("aewpjs_sso_attempted");if("disabled"!=AEJSWP.sso_type&&!AEJSWP.user_logged_in&&!e){var t=AEJSWP.getQueryStringValue("aewperror");if(""==t)return AEJSWP.setSessionStorageItem("aewpjs_sso_attempted",!0),!0;AEJSWP.debugOutput("onUser SSO login attempt failed, WP returned error: "+AEJSWP.login_fail_status_messages[t])}return!1},AEJSWP.ajaxUpdateState=function(e){void 0!==e.data&&(AEJSWP.debugOutput("Updating logged in state without page refresh, using the aeJS user object"),AEJSWP.authConnect(e),jQuery("."+AEJSWP.ajax_update_class).each((function(t,r){var a=jQuery(this).data("aewp-no-salutation"),o=jQuery(this).data("aewp-no-profile-link"),i=jQuery(this).data("aewp-no-logout-link"),s="";a||(s+='<span class="ae-wp-salutation">',s+=AEJSWP.logged_in_salutation.replace("{USERNAME}",e.data.Username),s+="</span>"),o||(s+='<span class="ae-wp-profile-link">',s+='<a href="'+AEJSWP.profile_link_url+'">'+AEJSWP.profile_link.replace("{USERNAME}",e.data.Username)+"</a>",s+="</span>"),i||(s+='<span class="ae-wp-logout-link">',s+='<a class="ae-wp-logout-anchor" href="#" onclick="AEJSWP.logout();">'+AEJSWP.logout_link+"</a>",s+="</span>"),jQuery(this).html(s)})))},AEJSWP.redirectFlowSigninErrorCheck=function(){if(6==AEJSWP.getQueryStringValue("aewperror")){var e=!1;if("undefined"!=typeof Storage&&AEJSWP.getSessionStorageItem("aewpjs_login_error_status_6_displayed")&&(e=AEJSWP.getSessionStorageItem("aewpjs_login_error_status_6_displayed")),!e){"undefined"!=typeof Storage&&(e=AEJSWP.setSessionStorageItem("aewpjs_login_error_status_6_displayed",!0),sso_attempted=AEJSWP.setSessionStorageItem("aewpjs_sso_attempted",!0));var t=AEJSWP.login_fail_status_messages[6].replace(new RegExp("<br/>","g"),"\n");alert(t)}}},AEJSWP.authConnect=function(e){void 0!==e&&void 0!==e.data&&(AEJSWP.debugOutput("Updating Auth Connect anchors: ",e),jQuery(".ae-wp-auth-connect-container").each((function(t,r){var a=jQuery(".ae-wp-authenticator-anchor",jQuery(this)),o=a.attr("data-ae-register-link"),i=a.attr("data-ae-login-link"),s=void 0!==a.attr("ae-wp-connect-provider")?a.attr("ae-wp-connect-provider"):a.attr("ae-wp-provider"),n=null,u="";if(void 0!==o&&!1!==o?(n=o,u="data-ae-register-link"):void 0!==i&&!1!==i?(n=i,u="data-ae-login-link"):void 0!==s&&!1!==s&&(n=s),n)if(AEJSWP.providerExistsInServices(e.services,n)){if(jQuery(this).trigger("ae-wp-auth-connected"),jQuery(this).addClass("ae-wp-auth-connected"),AEJSWP.auth_connected.length>0){var d='<span class="ae-wp-auth-connected-message">';d+=AEJSWP.auth_connected,d+="</span>",jQuery(this).html(d)}}else""!==u&&(a.removeAttr(u),a.attr("ae-wp-connect-provider",n))})))},AEJSWP.addAuthenticatorClickHandler=function(){jQuery(".ae-wp-authenticator-anchor").click((function(e){e.preventDefault();var t=AEJSWP.aeJS.settings.return_url;jQuery(this).hasClass("ae-disabled-login-hook")&&(t+="&disable-login-hook=true",AEJSWP.aeJS.settings.return_url=t,AEJSWP.login_redirect_url=t,AEJSWP.debugOutput("AE Auth Connect Triggered. Login hook has been disabled. Return URL:",t));var r=jQuery(this).attr("ae-wp-connect-provider"),a="auth";jQuery.isEmptyObject(AEJSWP.aeJS.user)&&(a="register"),AEJSWP.debugOutput("Authenticator anchor clicked, auth_type = "+a),void 0!==r&&!1!==r?(t+="&auth-connect=true",AEJSWP.debugOutput("AE Auth Connect Triggered. Return URL:",t),AEJSWP.aeJS.settings.return_url=t,AEJSWP.aeJS.trigger.authenticate(r,a)):(void 0===(r=jQuery(this).attr("ae-wp-provider"))&&(r=jQuery(this).attr("data-ae-register-link")),void 0===r&&(r=jQuery(this).attr("data-ae-login-link")),AEJSWP.aeJS.trigger.authenticate(r,a))}))},AEJSWP.trackEvent=function(e,t){var r="";switch(e){case"loginModalShown":AEJSWP.debugOutput("Firing loginModalShown event with data: ",String(t)),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".loginModalShown",window,String(t));break;case"registrationModalShown":AEJSWP.debugOutput("Firing registrationModalShown event with data: ",String(t)),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".registrationModalShown",window,String(t));break;case"login":var a=t,o=AEJSWP.getLastLoginService(a.services);r={service_name:o.Service,service_user_id:o.ID,ae_user_id:a.data.ID,ae_user_data:a},AEJSWP.debugOutput("Firing login event with data: ",r),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".login",window,r);break;case"registration":a=t,o=AEJSWP.getLastLoginService(a.services);r={service_name:o.Service,service_user_id:o.ID,ae_user_id:a.data.ID,ae_user_data:a},AEJSWP.debugOutput("Firing registration event with data: ",r),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".registration",window,r);break;case"newsletterRegistration":AEJSWP.debugOutput("Firing form registration event with data:"),r={},t.querySelectorAll("input, select").forEach((e=>{let t=e.name,a=e.value;e.name&&e.value&&(r[t]=a)})),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".newsletterRegistration",window,r);break;case"formErrors":AEJSWP.debugOutput("Firing formErrors event with data: ",t),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".formErrors",window,t);break;case"accountConnect":a=t,o=AEJSWP.getLastLoginService(a.services);r={service_name:o.Service,service_user_id:o.ID,ae_user_id:a.data.ID,ae_user_data:a},AEJSWP.debugOutput("Firing accountConnect event with data: ",r),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".accountConnect",window,r);break;case"optinsUpdated":AEJSWP.debugOutput("Firing optinsUpdated event with data: ",t),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".optinsUpdated",window,t)}},AEJSWP.fireFormErrorsEvent=function(e,t){"registration"!=e&&"login"!=e&&"mailinglist"!=e&&(e="login");var r={};r.form_errors=t,r.form_type=e,AEJSWP.trackEvent("formErrors",r)},AEJSWP.detect_safari_incognito=function(){var e=navigator.userAgent.indexOf("Chrome")>-1;if(navigator.userAgent.indexOf("Safari")>-1&&!e)try{var t="aejswp_test_item";localStorage.setItem(t,t),localStorage.removeItem(t)}catch(e){return!0}return!1},AEJSWP.detect_cookies_enabled=function(){if(!navigator.cookieEnabled)return!1;document.cookie="aejswp_test_cookie=1";var e=-1!==document.cookie.indexOf("aejswp_test_cookie=");return document.cookie="aejswp_test_cookie=; expires=Thu, 01 Jan 1970 00:00:00 UTC",e},AEJSWP.display_browser_config_error=function(e){var t="",r="";switch(e){case"safari_incognito":t="ae-cform-safari-incognito-error",r=AEJSWP.safari_incognito_error;break;case"cookies_disabled":t="ae-cform-cookies-disabled-error",r=AEJSWP.cookies_disabled_error}jQuery(".ae-cform-modal-container").length>0?(jQuery(".ae-cform-modal-container").css("position","relative"),jQuery(".ae-cform-modal-container, .ae-modal").prepend('<div class="'+t+'" style="display:none;"><p><span><span>'+r+"</span></span></p></div>")):(jQuery(".ae-cform-container").css("position","relative"),jQuery(".ae-cform-container, .ae-modal").prepend('<div class="'+t+'"  style="display:none;"><p><span><span>'+r+"</span></span></p></div>")),jQuery(".ae-cform-container").length>0&&jQuery(".ae-cform-container").height()<200&&jQuery("."+t+" p span span").css("font-size","0.85em"),setTimeout((function(){jQuery("."+t).show()}),1)},AEJSWP.setAutoColors=function(e){if(void 0!==e&&e.length)if(e.length>1)jQuery(e).each((function(){AEJSWP.setAutoColors(jQuery(this))}));else{var t=AEJSWP.getBrightnessLevel(e,"color"),r=AEJSWP.getBrightnessLevel(jQuery(e).parent(),"background-color")>120,a=t>120;r&&a?jQuery(e).css("color","black"):r||a||jQuery(e).css("color","white")}},AEJSWP.debugOutput=function(e,t){AEJSWP.debug&&(void 0!==t?console.log("AEJSWP: "+e,t):console.log("AEJSWP: "+e))},AEJSWP.debugOutput("AE Connect console logging enabled, disable debug in plugin settings to remove this output."),AEJSWP.debugOutput("Settings cached with plugin version: "+AEJSWP.plugin_version),AEJSWP.getQueryStringValue=function(e){return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+escape(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},AEJSWP.removeURLParameter=function(e,t){var r=e.split("?");if(r.length>=2){for(var a=encodeURIComponent(t)+"=",o=r[1].split(/[&;]/g),i=o.length;i-- >0;)-1!==o[i].lastIndexOf(a,0)&&o.splice(i,1);return e=r[0]+(o.length>0?"?"+o.join("&"):"")}return e},AEJSWP.addURLParameter=function(e,t,r){return e.replace(new RegExp("([?&]"+t+"(?=[=&#]|$)[^#&]*|(?=#|$))"),"&"+t+"="+encodeURIComponent(r)).replace(/^([^?&]+)&/,"$1?")},AEJSWP.executeFunctionByName=function(e,t){for(var r=Array.prototype.slice.call(arguments,2),a=e.split("."),o=a.pop(),i=0;i<a.length;i++){if(void 0===t)return!1;t=t[a[i]]}return void 0!==t&&void 0!==t[o]&&t[o].apply(t,r)},AEJSWP.setSessionStorageItem=function(e,t,r){try{return void 0===r&&(r=!1),"undefined"!=typeof Storage&&(r?sessionStorage.setItem(e,JSON.stringify(t)):sessionStorage.setItem(e,t),!0)}catch(e){return!1}},AEJSWP.getSessionStorageItem=function(e,t){try{if(void 0===t&&(t=!1),"undefined"!=typeof Storage){var r=sessionStorage.getItem(e);return r="false"!=(r="true"==r||r)&&r,t&&(r=JSON.parse(r)),r}return!1}catch(e){return!1}},AEJSWP.removeSessionStorageItem=function(e){try{return"undefined"!=typeof Storage&&(sessionStorage.removeItem(e),!0)}catch(e){return!1}},AEJSWP.setLocalStorageItem=function(e,t,r){try{return void 0===r&&(r=!1),"undefined"!=typeof Storage&&(r?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t),!0)}catch(e){return!1}},AEJSWP.getLocalStorageItem=function(e,t){try{if(void 0===t&&(t=!1),"undefined"!=typeof Storage){var r=localStorage.getItem(e);return r="false"!=(r="true"==r||r)&&r,t&&(r=JSON.parse(r)),r}return!1}catch(e){return!1}},AEJSWP.removeLocalStorageItem=function(e){try{return"undefined"!=typeof Storage&&(localStorage.removeItem(e),!0)}catch(e){return!1}},AEJSWP.providerExistsInServices=function(e,t){for(var r in e){var a=e[r];if(void 0!==a.Service&&a.Service==t)return!0}return!1},AEJSWP.getLastLoginService=function(e){var t={},r="2000-01-01 00:00:00";for(var a in e){var o=e[a];void 0!==o.Service&&"undefined"!=o.LastLogin&&o.LastLogin>r&&(t=o,r=o.LastLogin)}return t},AEJSWP.padString=function(e,t){return(e=e.toString()).length<t?AEJSWP.padString("0"+e,t):e},AEJSWP.userHasVerifiedEmail=function(){return void 0!==AEJSWP.aeJS.user.data&&void 0!==AEJSWP.aeJS.user.data.VerifiedEmail&&""!=AEJSWP.aeJS.user.data.VerifiedEmail},AEJSWP.clearSessionStorage=function(){AEJSWP.debugOutput("Clearing all session storage"),AEJSWP.removeSessionStorageItem("aejswp_ae_login_fired"),AEJSWP.removeSessionStorageItem("aejswp_initial_optin_choices"),AEJSWP.removeSessionStorageItem("aewpjs_login_error_status_6_displayed"),AEJSWP.removeSessionStorageItem("aewpjs_sso_attempted"),AEJSWP.clearCustomFormState(!0)},AEJSWP.getBrightnessLevel=function(e,t){var r=jQuery(e).css("background-image");if(void 0!==r&&r.length&&"none"!==r)return!1;var a=jQuery(e).css(t);if(void 0!==a){var o=AEJSWP.getRgbValues(a);if(o){if(void 0!==o.opacity)if(0===parseFloat(o.opacity)){if("background-color"===t){var i=jQuery(e).parent();if(i&&i.length)return AEJSWP.getBrightnessLevel(i,t)}return 255}return Math.round((299*parseInt(o.red)+587*parseInt(o.green)+114*parseInt(o.blue))/1e3)}}return!1},AEJSWP.getRgbValues=function(e){var t=e.match(/rgba?\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)?(?:, ?(\d(?:\.?\d?))\))?/);return!!t&&{red:t[1],green:t[2],blue:t[3],opacity:t[4]}},AEJSWP.getCurrentState=function(){AEJSWP.debugOutput("CURRENT STATE >>"),AEJSWP.debugOutput("",AEJSWP),AEJSWP.debugOutput("aeJS",AEJSWP.aeJS),AEJSWP.debugOutput("user",AEJSWP.aeJS.user),AEJSWP.debugOutput("SessionStorage: aejswp_cform_id",AEJSWP.getLocalStorageItem("aejswp_cform_id")),AEJSWP.debugOutput("SessionStorage: aejswp_cform_prev_return_url",AEJSWP.getSessionStorageItem("aejswp_cform_prev_return_url")),AEJSWP.debugOutput("SessionStorage: aejswp_cform_prev_auth_window",AEJSWP.getSessionStorageItem("aejswp_cform_prev_auth_window")),AEJSWP.debugOutput("SessionStorage: aejswp_cform_prev_extra_fields",AEJSWP.getSessionStorageItem("aejswp_cform_prev_extra_fields"),!0),AEJSWP.debugOutput("SessionStorage: aejswp_ae_login_fired",AEJSWP.getSessionStorageItem("aejswp_ae_login_fired")),AEJSWP.debugOutput("SessionStorage: aejswp_verify_email_in_progress",AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")),AEJSWP.debugOutput("SessionStorage: aejswp_verify_email_sent",AEJSWP.getSessionStorageItem("aejswp_verify_email_sent")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_in_progress",AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_email",AEJSWP.getSessionStorageItem("aejswp_password_reset_email")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_member_service_id",AEJSWP.getSessionStorageItem("aejswp_password_reset_member_service_id")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_force_modal_open",AEJSWP.getSessionStorageItem("aejswp_password_reset_force_modal_open")),AEJSWP.debugOutput("SessionStorage: aejswp_user_casl_in_progress",AEJSWP.getSessionStorageItem("aejswp_user_casl_in_progress",!0)),AEJSWP.debugOutput("SessionStorage: aejswp_initial_optin_choices",AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0)),AEJSWP.debugOutput("SessionStorage: aejswp_user_cancelled_cform_modal_display",AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0)),AEJSWP.debugOutput("SessionStorage: aejswp_user_opened_cform_modal_display",AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0)),AEJSWP.debugOutput("SessionStorage: aewpjs_login_error_status_6_displayed",AEJSWP.getSessionStorageItem("aewpjs_login_error_status_6_displayed")),AEJSWP.debugOutput("SessionStorage: aewpjs_sso_attempted",AEJSWP.getSessionStorageItem("aewpjs_sso_attempted")),AEJSWP.debugOutput("LocalStorage: aejswp_user_casl_completed",AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)),AEJSWP.debugOutput("LocalStorage: aejswp_first_optins_post_completed",AEJSWP.getLocalStorageItem("aejswp_first_optins_post_completed",!0)),AEJSWP.debugOutput("LocalStorage: aeswp_cform_mailing_lists_completed",AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0)),AEJSWP.debugOutput("LocalStorage: aejswp_optin_choices",AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0))},AEJSWP.resetAllState=function(){AEJSWP.debugOutput("Clearing all local storage"),AEJSWP.removeLocalStorageItem("aeswp_cform_mailing_lists_completed"),AEJSWP.removeLocalStorageItem("aejswp_optin_choices"),AEJSWP.removeLocalStorageItem("aejswp_user_casl_completed"),AEJSWP.removeLocalStorageItem("aejswp_first_optins_post_completed"),AEJSWP.logout()},AEJSWP.customFormRenderRecaptcha=function(e){e.each((function(){cform_id=jQuery(this).data("ae-cform-id");const e=jQuery(this).data("hash-selector")?jQuery(this).data("hash-selector"):jQuery(this).find("[data-hash-selector]").data("hash-selector");AEJSWP.debugOutput("Rendering Captcha form on element #ae-cform-captcha-"+cform_id),jQuery(`#ae-cform-captcha-${cform_id}`).length>0&&void 0===AEJSWP.custom_forms[cform_id].captcha_widget&&(AEJSWP.custom_forms[cform_id].captcha_widget=grecaptcha.render(`ae-cform-captcha-${cform_id}`,{sitekey:AEJSWP.custom_forms[cform_id].recaptcha_key,size:"invisible",badge:"inline",callback:()=>{AEJSWP.captchaVerifyCallback(cform_id,e)}}))}))},AEJSWP.customFormEvent=!1,AEJSWP.customFormEventFormID=!1,AEJSWP.customFormSubmit=function(e,t,r){const a=void 0!==r?jQuery(`.ae-cform-container.${r}`):jQuery(`#ae-cform-container-${e}`);if(jQuery(a).hasClass("-has-modal"))var o=void 0!==r?jQuery(`.ae-cform-modal-container.${r}`).find(`#ae-cform-email-reg-${e}`):jQuery(`#ae-cform-modal-container-${e}`).find(`#ae-cform-email-reg-${e}`);else o=void 0!==r?jQuery(`.ae-cform-container.${r}`).find(`#ae-cform-email-reg-${e}`):jQuery(`#ae-cform-container-${e}`).find(`#ae-cform-email-reg-${e}`);if(AEJSWP.hideFormError(o),"function"==typeof o.parsley&&o.parsley({errorsContainer:function(e){if(void 0!==e.$element.attr("data-intl-tel-input-id")&&e.$element.parents(".ae-cform-item-mobilephone").length>0)return e.$element.parents(".ae-cform-item-mobilephone");return e}}).validate(),"undefined"!=typeof grecaptcha&&!AEJSWP.custom_forms[e].captchaVerified&&void 0!==AEJSWP.custom_forms[e].captcha_widget)return AEJSWP.customFormEvent=t,AEJSWP.customFormEventFormID=e,AEJSWP.debugOutput("Recaptcha activated on widget "+AEJSWP.custom_forms[e].captcha_widget),t.preventDefault(),void grecaptcha.execute(AEJSWP.custom_forms[e].captcha_widget);AEJSWP.debugOutput("User submitted custom form "+e);var i=parseInt(AEJSWP.custom_forms[e].type_id),s=AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0):[],n=(s[e],1==s[e]),u=AEJSWP.getSessionStorageItem("aejswp_user_casl_in_progress")==e;if(void 0!==t&&!n&&u&&(AEJSWP.debugOutput("User completed CASL compliance flow, updating state"),s[e]=!0,AEJSWP.removeSessionStorageItem("aejswp_user_casl_in_progress"),AEJSWP.setLocalStorageItem("aejswp_user_casl_completed",s,!0)),void 0===t||2!=i||jQuery(".parsley-error",o).length||(AEJSWP.debugOutput("Mailing list form submission click without an AE user"),t.preventDefault(),AEJSWP.mailingListFormValidation(e,r)),void 0!==t&&1==i){if(AEJSWP.debugOutput("Registration form - running parsley validation"),jQuery(".parsley-error",o).length||void 0!==AEJSWP.formComplete&&!AEJSWP.formComplete){AEJSWP.debugOutput("Parsley errors - registration form not yet complete, preventing AE submit"),t.preventDefault();var d=[];return jQuery(".parsley-errors-list li",o).each((function(){var e=jQuery(this)[0].innerHTML;d.push(e)})),void AEJSWP.fireFormErrorsEvent("registration",d)}if(AEJSWP.applyCustomFormSettings(e,t,r),AEJSWP.debugOutput("No parsley errors"),!AEJSWP.minimumAgeCheck(e,r))return void t.preventDefault();if(void 0!==AEJSWP.custom_forms[e].form_fields.captcha)if(AEJSWP.debugOutput("Registration form has a captcha."),void 0!==AEJSWP.aeJS.user.data)AEJSWP.debugOutput("Authenticated user session found, captcha check not applied");else{if(!AEJSWP.custom_forms[e].captchaVerified)return AEJSWP.debugOutput("Registration form captcha not validated, preventing AE submit"),t.preventDefault(),AEJSWP.setFormError(o,AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete),void AEJSWP.fireFormErrorsEvent("registration",[AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete]);AEJSWP.debugOutput("Form captcha validated"),AEJSWP.hideFormError(o)}else AEJSWP.debugOutput("No captcha on form");if(void 0===AEJSWP.ae_form_submit_in_progress||0==AEJSWP.ae_form_submit_in_progress)AEJSWP.ae_form_submit_in_progress=!0,AEJSWP.debugOutput("Submitting form to AE"),t.preventDefault(),(c=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[])[e]=!0,AEJSWP.setSessionStorageItem("aejswp_user_cancelled_cform_modal_display",c,!0),AEJSWP.aeJS.trigger.submit(t.target.form),AEJSWP.trackEvent("newsletterRegistration",t.target.form);else 1==AEJSWP.ae_form_submit_in_progress&&(t.preventDefault(),AEJSWP.debugOutput("Stopping form submit as user has previously clicked the submit button, still waiting on response from AE"))}else{if(AEJSWP.debugOutput("Mailing List - running parsley validation"),jQuery(".parsley-error",o).length||!AEJSWP.formComplete){AEJSWP.debugOutput("Parsley errors - registration form not yet complete, preventing AE submit"),t.preventDefault();d=[];return jQuery(".parsley-errors-list li",o).each((function(){var e=jQuery(this)[0].innerHTML;d.push(e)})),void AEJSWP.fireFormErrorsEvent("mailinglist",d)}if(AEJSWP.applyCustomFormSettings(e,t,r),AEJSWP.debugOutput("No parsley errors"),!AEJSWP.minimumAgeCheck(e,r))return void t.preventDefault();var c;(c=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[])[e]=!0,AEJSWP.setSessionStorageItem("aejswp_user_cancelled_cform_modal_display",c,!0)}},AEJSWP.applyCustomFormSettings=function(e,t,r){var a=parseInt(AEJSWP.custom_forms[e].type_id);if(AEJSWP.debugOutput("Applying Custom Form settings for cform_id = "+e+", cform_type_id = "+a),AEJSWP.setLocalStorageItem("aejswp_cform_id",e),AEJSWP.setLocalStorageItem("aejswp_cform_hash",r),void 0!==r&&AEJSWP.setLocalStorageItem("aejswp_cform_hash_sso",r),void 0!==AEJSWP.aeJS){AEJSWP.setSessionStorageItem("aejswp_cform_prev_return_url")||(AEJSWP.setSessionStorageItem("aejswp_cform_prev_return_url",AEJSWP.aeJS.settings.return_url),AEJSWP.setSessionStorageItem("aejswp_cform_prev_auth_window",AEJSWP.aeJS.settings.auth_window),AEJSWP.setSessionStorageItem("aejswp_cform_prev_extra_fields",AEJSWP.aeJS.settings.extra_fields,!0)),AEJSWP.aeJS.settings.display_error_message=!1,AEJSWP.aeJS.settings.extra_fields_screen=!1,AEJSWP.aeJS.settings.verify_email=!1,0==AEJSWP.aeJS.settings.auth_window&&(AEJSWP.aeJS.settings.return_url=""!=AEJSWP.custom_forms[e].page_url?AEJSWP.custom_forms[e].page_url:window.location.href);var o="",i=AEJSWP.custom_forms[e].signin_options;for(var s in i)""!=i[s]["ae-service"]&&(o+=i[s]["ae-service"]+",");for(var s in o=o.replace(/,\s*$/,""),AEJSWP.aeJS.settings.services=o,AEJSWP.aeJS.settings.extra_fields={},AEJSWP.custom_forms[e].form_fields)if("password"!=s&&"captcha"!=s){var n=AEJSWP.custom_forms[e].form_fields,u="1"==Object.values(n[s])[0];AEJSWP.aeJS.settings.extra_fields[s]="email"==s||u?{label:s,required:!0}:{label:s,required:!1}}AEJSWP.debugOutput("Modified aeJS",AEJSWP.aeJS.settings)}null!=t&&(t.preventDefault(),void 0===AEJSWP.ae_form_submit_in_progress||0==AEJSWP.ae_form_submit_in_progress?(AEJSWP.ae_form_submit_in_progress=!0,AEJSWP.debugOutput("Submitting form to AE"),AEJSWP.aeJS.trigger.submit(t.target.form),AEJSWP.trackEvent("newsletterRegistration",t.target.form)):AEJSWP.debugOutput("Stopping form submit as user has previously clicked the submit button, still waiting on response from AE"))},AEJSWP.customFormValidation=function(e){AEJSWP.debugOutput("Custom form validation");var t=AEJSWP.getLocalStorageItem("aejswp_cform_id");const r=AEJSWP.getLocalStorageItem("aejswp_cform_hash");var a=AEJSWP.checkUserRequiredFields(t,e,r);if(a.length>0)return AEJSWP.ae_login_fired&&(AEJSWP.ae_login_fired=!1,AEJSWP.redirectToCustomFormPage(t)),void AEJSWP.displayAdditionalDetailsForm(t,a);if(AEJSWP.verify_email&&!AEJSWP.userHasVerifiedEmail())return AEJSWP.debugOutput("Verified Email required, but missing"),AEJSWP.setSessionStorageItem("aejswp_verify_email_in_progress",e.data.Email),AEJSWP.displayVerifyEmail(t,e.data.Email),void AEJSWP.sendVerifyEmail(e.data.Email);switch(AEJSWP.custom_form_complete=!0,1==parseInt(AEJSWP.custom_forms[t].modal_display)&&jQuery.modal.close(),AEJSWP.clearCustomFormState(!0),parseInt(AEJSWP.custom_forms[t].type_id)){case 1:AEJSWP.debugOutput("Finished registration custom form"),AEJSWP.logUserIn(e,t);break;case 2:AEJSWP.debugOutput("Finished mailing list custom form"),AEJSWP.mailingListFormComplete(t,e.data,r)}},AEJSWP.isSMSOptinEnabled=function(e,t){var r=!1,a=AEJSWP.getUserOptinChoices(e,!1,t);for(var o in a){var i=a[o];if(void 0!==i.type&&"sms"===i.type&&!0===i.user_choice){r=!0;break}}return r},AEJSWP.isEmailOptinEnabled=function(e,t){var r=!1,a=AEJSWP.getUserOptinChoices(e,!1,t);for(var o in a){var i=a[o];if(void 0!==i.type&&"email"===i.type&&!0===i.user_choice){r=!0;break}}return r},AEJSWP.checkUserRequiredFields=function(e,t,r){AEJSWP.debugOutput("Checking user record for required fields on cform "+e);var a=[],o=AEJSWP.custom_forms[e].form_fields,i=AEJSWP.isSMSOptinEnabled(e,r),s=AEJSWP.isEmailOptinEnabled(e,r);for(var n in o){var u=Object.keys(o[n])[0],d=1==Object.values(o[n])[0],c=jQuery(".ae-cform-item.ae-cform-item-"+n).data("dynamic-field");if(i&&"country"===n||i&&"mobilephone"===n||"password"!==n&&"captcha"!==n&&d&&"disabled"!==c)if(void 0===t.data[u]||""==t.data[u]||null==t.data[u]||"Unknown"==t.data[u]||"mobilephone"===n&&i||"country"===n&&i)a.push(n);else if("country"==n){var l="1"==AEJSWP.custom_forms[e].opt_ins_casl_enabled,m=0!=Object.keys(AEJSWP.custom_forms[e].opt_ins).length,S=void 0!==t.data.CountryCode&&"CA"==t.data.CountryCode||void 0!==t.data.Country&&"Canada"==t.data.Country||void 0!==t.data.GeoCountry&&"CA"==t.data.GeoCountry,_=AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0):[],p=(_[e],1==_[e]);l&&m&&S&&!p&&(AEJSWP.debugOutput("User is from Canada and has not yet completed CASL flow - forcibly adding country to missing fields & updating opt-ins for CASL compliance"),a.push("country"),AEJSWP.updateCaslLabels(!0),AEJSWP.setSessionStorageItem("aejswp_user_casl_in_progress",e))}else"birthdate"==n&&(AEJSWP.minimumAgeCheck(e,r)||a.push(n));else"email"==n&&s?void 0!==t.data[u]&&""!=t.data[u]&&null!=t.data[u]&&"Unknown"!=t.data[u]||a.push(n):"enabled"==c&&a.push(n)}return a.length>0&&AEJSWP.debugOutput("User is missing fields: "+a),a},AEJSWP.minimumAgeCheck=function(e,t){if(AEJSWP.minimum_age){AEJSWP.debugOutput("Minimum age of "+AEJSWP.minimum_age+" required");var r=jQuery(`.ae-cform-container.${t},.ae-cform-modal-container.${t}`).find("#ae-cform-input-reg-birthdate-"+e).val();void 0!==r&&""!=r&&"undefined"!=r&&parseInt(r)==parseInt(r)||(AEJSWP.debugOutput("no dob field on form, using dob from user record"),r=void 0!==AEJSWP.aeJS.user.data&&void 0!==AEJSWP.aeJS.user.data.BirthDate?AEJSWP.aeJS.user.data.BirthDate:new Date),r=new Date(r);var a=new Date,o=Math.floor((a-r)/31536e6);if(AEJSWP.debugOutput("User is "+o),o<=AEJSWP.minimum_age){AEJSWP.debugOutput("User is not old enough");var i=AEJSWP.custom_forms[e].flow_labels.form_error_age_check_fail;i=i.replace("{AGE}",AEJSWP.minimum_age);var s=jQuery("#ae-cform-email-reg-"+e);return AEJSWP.setFormError(s,i),1==parseInt(AEJSWP.custom_forms[e].type_id)?AEJSWP.fireFormErrorsEvent("registration",[i]):AEJSWP.fireFormErrorsEvent("mailinglist",[i]),!1}}return!0},AEJSWP.displayAdditionalDetailsForm=function(e,t){AEJSWP.debugOutput("Displaying additional details form");var r=parseInt(AEJSWP.custom_forms[e].type_id),a=AEJSWP.custom_forms[e].form_fields;for(var o in a)1==r?(t.includes(o)?jQuery("#ae-cform-reg-item-"+o+"-"+e).show():jQuery("#ae-cform-reg-item-"+o+"-"+e).remove(),"password"==o&&jQuery("#ae-cform-reg-item-password-confirm-"+e).remove()):t.includes(o)?jQuery("#ae-cform-reg-item-"+o+"-"+e).show():jQuery("#ae-cform-reg-item-"+o+"-"+e).hide();AEJSWP.updateCustomForms(),jQuery("#ae-cform-title-"+e).html(AEJSWP.custom_forms[e].flow_labels.additional_info_title),jQuery("#ae-cform-signin-options-"+e).hide(),jQuery("#ae-cform-email-container-"+e).show(),jQuery("#ae-cform-email-reg-container-"+e).show(),jQuery("#ae-cform-email-login-container-"+e).hide(),jQuery("#ae-cform-already-registered-link-"+e).hide()},AEJSWP.redirectToCustomFormPage=function(e){var t=AEJSWP.custom_forms[e].page_url;return""!=t&&-1==window.location.href.indexOf(t)&&(AEJSWP.debugOutput("Redirecting user to custom form page: "+t),window.location.href=t,!0)},AEJSWP.mailingListFormValidation=function(e,t){AEJSWP.debugOutput("Mailing list form submit");var r=jQuery(`.${t}`).find("#ae-cform-email-reg-"+e),a=AEJSWP.custom_forms[e].form_fields,o=!0;for(var i in a){var s="1"==Object.values(a[i]);if("password"!=i&&"captcha"!=i){var n="";"mobilephone"===i?(s="required"==jQuery(r).find(`#ae-cform-input-reg-mobilephone-${e}`).attr("required"),n=window.AEWPFrontEnd.forms[e].hashSelectors[t].iti.getNumber()):n=jQuery(r).find("#ae-cform-reg-item-"+i+"-"+e+" :input").val(),AEJSWP.debugOutput(i+" = "+n),""==n&&s&&(o=!1)}}if(!AEJSWP.minimumAgeCheck(e,t))return;if(void 0!==AEJSWP.custom_forms[e].form_fields.captcha){if(AEJSWP.debugOutput("Email form has a captcha."),!AEJSWP.custom_forms[e].captchaVerified)return AEJSWP.debugOutput("Captcha not complete / validated."),AEJSWP.setFormError(r,AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete),void AEJSWP.fireFormErrorsEvent("mailinglist",[AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete]);AEJSWP.debugOutput("Captcha complete.")}let u=AEJSWP.custom_forms[e].flow_labels.form_error_incomplete;if(o){0===AEJSWP.getCheckedOptins(e,t).length&&(u=AEJSWP.custom_forms[e].flow_labels.form_error_incomplete_optins,o=!1)}if(o){AEJSWP.debugOutput("Mailing List Form complete, next steps...");var d=AEJSWP.getNonAEUserDetails(e,t);AEJSWP.mailingListFormComplete(e,d,t),AEJSWP.formComplete=!0}else AEJSWP.debugOutput("Mailing List Form incomplete"),AEJSWP.setFormError(r,u),AEJSWP.fireFormErrorsEvent("mailinglist",[u]),AEJSWP.formComplete=!1},AEJSWP.getNonAEUserDetails=function(e,t){var r={},a=AEJSWP.custom_forms[e].form_fields;for(var o in a)if("password"!=o&&"captcha"!=o){if("mobilephone"===o)var i=window.AEWPFrontEnd.forms[e].hashSelectors[t].iti.getNumber();else if(void 0!==t)i=jQuery('[data-hash-selector="'+t+'"] #ae-cform-input-reg-'+o+"-"+e).val();else i=jQuery("#ae-cform-reg-item-"+o+"-"+e+" :input").val();var s=a[o];r[Object.keys(s)[0]]=i}return AEJSWP.debugOutput("Non AE User data",r),r},AEJSWP.mailingListFormComplete=function(e,t,r){AEJSWP.debugOutput("Mailing list completed, cform_id = "+e);var a=AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0)||[],o=!1;for(var i in a)a[i]==e&&(o=!0);o||(a.push(e),AEJSWP.setLocalStorageItem("aeswp_cform_mailing_lists_completed",a,!0),AEJSWP.maybe_wait_for_event("send_user_optins",(function(){var a=AEJSWP.getUserOptinChoices(e,!1,r);AEJSWP.sendUserOptins(e,t,a,r),AEJSWP.displayMailingListSuccess(e,r),AEJSWP.executeFunctionByName("AEJSWP.mailingListFormCompleteCallback",window,e,t);for(var o=0;o<AEJSWP.mailingListFormCompletedCallbacks.length;o++)for(var i in AEJSWP.mailingListFormCompletedCallbacks[o])AEJSWP.debugOutput("Calling custom aejsready_handler : "+AEJSWP.mailingListFormCompletedCallbacks[o][i]),AEJSWP.executeFunctionByName(AEJSWP.mailingListFormCompletedCallbacks[o][i],window,e,t)})))},AEJSWP.displayMailingListSuccess=function(e,t){void 0!==t&&"undefined"!=t||void 0!==(t=jQuery(`#ae-cform-modal-container-${e}.modal`).is(":visible")?jQuery(`.modal[data-ae-cform-id=${e}]`).data("hash-selector"):jQuery(`.ae-cform-container[data-ae-cform-id=${e}]:not(.-has-modal)`).data("hash-selector"))&&"undefined"!=t||(t=AEJSWP.getLocalStorageItem("aejswp_cform_hash_sso").replace(/"/g,"")),AEJSWP.debugOutput(`Mailing list form id ${e} and hash ${t} completed`);var r=jQuery(`.${t}[data-ae-cform-id=${e}]:not(.-has-modal)`);if(r.length)if(r.attr("data-custom-cta")){var a=jQuery(".ae-custom-cta");a.length&&jQuery(a).each((function(){var e=AEJSWP.getCustomCTAFormID(jQuery(this)),t=jQuery("#ae-cform-mailing-list-success-"+e).html();t.length?jQuery(this).replaceWith(t):jQuery(this).remove()}))}else r.html(jQuery("#ae-cform-mailing-list-success-"+e).html()),r.addClass("ae-cform-mailing-list-success-"+e);jQuery(`.jquery-modal #ae-cform-modal-container-${e}.${t}`).length},AEJSWP.addAEHandlerBackToCustomForm=function(e){void 0!==AEJSWP.aeJS.user.data&&(AEJSWP.debugOutput("AE user detected, adding AE handler back to any custom forms"),jQuery("#ae-cform-email-reg-"+e).attr("data-ae-register-form","email"),AEJSWP.aeJS.trigger.attach())},AEJSWP.displayVerifyEmail=function(e,t){jQuery("#ae-cform-verify-email-container-"+e).show();var r=jQuery("#ae-cform-verify-email-container-"+e+" > .ae-cform-verify-email-instructions").html().replace("{USEREMAIL}",t);jQuery("#ae-cform-verify-email-container-"+e+" > .ae-cform-verify-email-instructions").html(r),jQuery("#ae-cform-mailing-list-success-"+e).hide(),jQuery("#ae-cform-title-"+e).hide(),jQuery("#ae-cform-signin-options-"+e).hide(),jQuery("#ae-cform-email-container-"+e).hide(),jQuery("#ae-cform-optins-container-"+e).hide()},AEJSWP.sendVerifyEmail=function(e,t){t=t||!1;AEJSWP.debugOutput("Triggering verify email send to "+e);var r={subject:AEJSWP.aeJS.settings.email_format.verify_email_subject,body:AEJSWP.aeJS.settings.email_format.verify_email_message,label:AEJSWP.aeJS.settings.email_format.verify_email_link},a=window.location.href;if(void 0!==AEJSWP.param_on_return_url_key&&Array.isArray(AEJSWP.param_on_return_url_key))for(var o=0;o<AEJSWP.param_on_return_url_key.length;o++)a=AEJSWP.addURLParameter(a,AEJSWP.param_on_return_url_key[o],AEJSWP.param_on_return_url_value[o]);if(t){r={subject:AEJSWP.aeJS.settings.email_format.reset_pw_email_subject,body:AEJSWP.aeJS.settings.email_format.reset_pw_email_message,label:AEJSWP.aeJS.settings.email_format.reset_pw_email_link};a=AEJSWP.addURLParameter(a,"password_reset",t)}AEJSWP.debugOutput("sendVerifyEmail return_url = "+a),AEJSWP.aeJS.trigger.send_verify_email(a,e,r)},AEJSWP.updateCustomForms=function(){AEJSWP.debugOutput("Updating custom form display states");var e=AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0),t=Array();jQuery(".ae-cform-container, .ae-cform-modal-container").each((function(){t.push(jQuery(this).data("ae-cform-id"))}));e=e.map((function(e){return parseInt(e,10)}));for(let r=0;r<t.length;r++)-1!==e.indexOf(t[r])?(jQuery("[id^=ae-cform-container-"+t[r]+"] .newsletter-wrapper").css("grid-template-columns","1fr"),jQuery("[id^=ae-cform-container-"+t[r]+"] .ae-cform-mailing-list-success").show(),jQuery("[id^=ae-cform-container-"+t[r]+"] .ae-cform-email-reg-container").hide(),jQuery("[id^=ae-cform-container-"+t[r]+"] .ae-cform-optins-container").hide(),jQuery("[id^=ae-cform-container-"+t[r]+"] .ae-cform-email-container").show()):(jQuery("[id^=ae-cform-container-"+t[r]+"] .ae-cform-title").css("display",""),jQuery("[id^=ae-cform-container-"+t[r]+"] .ae-cform-signin-options").show(),jQuery("[id^=ae-cform-container-"+t[r]+"] .newsletter-image-container").show(),jQuery("[id^=ae-cform-modal-container-"+t[r]+"] .ae-cform-title").css("display",""),jQuery("[id^=ae-cform-modal-container-"+t[r]+"] .ae-cform-signin-options").show(),jQuery("[id^=ae-cform-modal-container-"+t[r]+"] .newsletter-image-container").show());var r=jQuery.fn.jquery.split(".");parseInt(r[0])<=1&&parseInt(r[1])<8&&(console.log("The version of jQuery on the page is too old for AE Connect custom forms, please upgrade to 1.8.x or better"),jQuery(".ae-cform-container").html("The loaded version of jQuery is too old. Please upgrade to 1.8.x or better.")),jQuery(".ae-cform-container, .ae-cform-modal-container").each((function(){const e=jQuery(this);jQuery(this).data("hash-selector");var t=jQuery(this).data("ae-cform-id");void 0!==AEJSWP.custom_forms[t].expanded_email&&0!=parseInt(AEJSWP.custom_forms[t].expanded_email)&&""!=AEJSWP.custom_forms[t].expanded_email&&(AEJSWP.debugOutput("Custom form "+t+" is set to show email form"),jQuery(e).find("#ae-cform-email-container-"+t).show(),1==Object.keys(AEJSWP.custom_forms[t].signin_options).length&&jQuery(e).find("#ae-cform-signin-options-"+t).hide())}));var a=setInterval((function(){jQuery(".grecaptcha-badge").length>0&&(jQuery(".grecaptcha-badge").each((function(e){0==e?(jQuery(this).appendTo("#grecaptcha-badge-cform"),jQuery("#grecaptcha-badge-cform").show(),jQuery(this).css("visibility","visible")):jQuery(this).hide()})),clearInterval(a))}),30);if(void 0!==AEJSWP.aeJS&&void 0!==AEJSWP.aeJS.user.data){var o=AEJSWP.aeJS.user.data;jQuery(".ae-cform-container, .ae-cform-modal-container").each((function(){const e=jQuery(this).data("ae-cform-id"),t=jQuery(this).data("hash-selector");if(void 0!==t&&void 0!==e){var r=AEJSWP.custom_forms[e].form_fields;for(var a in r){var i=Object.keys(r[a])[0];switch(a){case"birthdate":var s=o[i];null!=s&&10==s.length&&(jQuery(".ae-cform-item-"+a+" input[name=s_birthdate_day]").val(s.substring(8,10)),jQuery(".ae-cform-item-"+a+" input[name=s_birthdate_month]").val(s.substring(5,7)));break;case"country":var n=null;void 0!==o.CountryCode?n=o.CountryCode:void 0!==o.GeoCountry&&(n=o.GeoCountry),n&&(jQuery("#ae-cform-input-reg-country-"+e).val(n),AEJSWP.isSMSOptinEnabled(e,t)&&null!==AEWPFrontEnd.forms[e].hashSelectors[t].iti&&AEWPFrontEnd.forms[e].hashSelectors[t].iti.setCountry(n));var u=jQuery("#ae-cform-input-reg-country-"+e).val(),d="1"==AEJSWP.custom_forms[e].opt_ins_casl_enabled;"CA"==u&&d&&(AEJSWP.debugOutput("CASL enabled & user is from Canada, updating opt-ins & terms for CASL compliance"),AEJSWP.updateCaslLabels(!0));break;case"mobilephone":AEJSWP.isSMSOptinEnabled(e,t)||jQuery(".ae-cform-item-"+a+" .ae-cform-input").val(AEJSWP.aeJS.user.data[i]);break;default:jQuery(".ae-cform-item-"+a+" .ae-cform-input").val(AEJSWP.aeJS.user.data[i])}}}}))}AEJSWP.updateDOB(),AEJSWP.getLocalStorageItem("aejswp_cform_id")&&void 0!==AEJSWP.aeJS&&void 0!==AEJSWP.aeJS.user.data&&AEJSWP.hideCaptchaOnForm(AEJSWP.getLocalStorageItem("aejswp_cform_id")),AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")&&!AEJSWP.userHasVerifiedEmail()&&AEJSWP.displayVerifyEmail(AEJSWP.getLocalStorageItem("aejswp_cform_id"),AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")),AEJSWP.getSessionStorageItem("aejswp_password_reset_member_service_id")&&AEJSWP.displayEnterNewPassword(),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress")||""==AEJSWP.getQueryStringValue("password_reset")||AEJSWP.setSessionStorageItem("aejswp_password_reset_in_progress",!0),AEJSWP.restoreUserOptins(),jQuery("[data-ae-cform-id]").each((function(){const e=jQuery(this).attr("data-ae-cform-id");jQuery(".ae-cform-optin-checkbox",jQuery(this)).each((function(){AEJSWP.updateRelatedField(e,jQuery(this))}))}));var i=AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0);if(i)for(var s=0;s<i.length;s++)AEJSWP.displayMailingListSuccess(i[s]);var n=AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0)?AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0):[],u=AEJSWP.getLocalStorageItem("aejswp_cform_id");if(u&&n[u]){AEJSWP.debugOutput("Custom form flow still in progress and user has previously opened modal");var d=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[],c="undefined"!=d[u]&&"null"!=d[u]&&1==d[u];1==parseInt(AEJSWP.custom_forms[u].modal_display)&&(""!=AEJSWP.getQueryStringValue("password_reset")?AEJSWP.debugOutput("Not re-opening modal, password reset redirect in progress"):AEJSWP.getSessionStorageItem("aejswp_password_reset_force_modal_open")?(AEJSWP.debugOutput("User returning from password reset, so re-opening modal"),jQuery("#ae-cform-modal-container-"+u).modal().trigger("ae-modal-open"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open")):c?AEJSWP.debugOutput("User previously clicked close on this custom from modal, so not re-opening automatically"):(AEJSWP.debugOutput("User has not closed the modal themseleves, so re-opening modal automatically"),jQuery("#ae-cform-modal-container-"+u).modal().trigger("ae-modal-open")))}else u&&1==parseInt(AEJSWP.custom_forms[u].modal_display)&&(AEJSWP.debugOutput("Custom form flow still in progress and custom form is using modal display, but user has not opened it yet"),AEJSWP.getSessionStorageItem("aejswp_password_reset_force_modal_open")&&""!=!AEJSWP.getQueryStringValue("password_reset")&&(AEJSWP.debugOutput("Password reset in progress, so re-opening modal"),jQuery("#ae-cform-modal-container-"+u).modal().trigger("ae-modal-open"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open")))},AEJSWP.restoreUserOptins=function(){AEJSWP.debugOutput("Restoring user optin choices");var e=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);const t=AEJSWP.getLocalStorageItem("aejswp_cform_hash",!0),r=jQuery(`.${t}`);if(e)for(var a=0;a<e.length;a++)if(null!=e[a]){var o=jQuery(r).find('.ae-cform-optin-checkbox[data-ae-optin-id="'+a+'"]');if(o.length){var i=o.parents("[data-ae-cform-id]");if(i.length){var s=parseInt(i.attr("data-ae-cform-id"));if(void 0!==AEJSWP.custom_forms[s]){if(1==parseInt(AEJSWP.custom_forms[s].type_id))return;o.closest(".ae-cform-implied-optin").length<1&&(o.prop("checked",e[a]),o.change(),AEJSWP.enableSignUpFormSubmitButtons(a,s,e[a],t))}}}}},AEJSWP.sendUserOptins=function(e,t,r,a){void 0!==a&&"undefined"!=a||(a=AEJSWP.getLocalStorageItem("aejswp_cform_hash_sso").replace(/"/g,""));var o=AEJSWP.getUserUpdatedOptins(e,r);if(o){AEJSWP.debugOutput("Posting user + optin data for cform_id "+e+" and hash : "+a),t=AEJSWP.run_filter("filter__optin_user_data",t),void 0!==AEJSWP.aeJS.user&&AEJSWP.aeJS.user.hasOwnProperty("services")&&(t.services=AEJSWP.aeJS.user.services[0].Service),void 0!==t.Country&&0!=t.Country.length||null!==AEJSWP.getLocalStorageItem("aejswp_user_country_by_ip")&&(t.Country=AEJSWP.getLocalStorageItem("aejswp_user_country_by_ip"));var i={action:AEJSWP.ajax_action_send_user_optins,cform_id:e,user_data:t,optins:o,confirm_code:"undefined"!=typeof grecaptcha&&void 0!==AEJSWP.custom_forms[e].captcha_widget?grecaptcha.getResponse(AEJSWP.custom_forms[e].captcha_widget):""};AEJSWP.debugOutput("WP Update User Optins AJAX request : ",i),jQuery.post(AEJSWP.ajaxurl,i,(function(r){try{if(0==(r=jQuery.parseJSON(r)).status)console.log("AEJSWP Error: Update User Optins AJAX response : ",r);else{AEJSWP.debugOutput("WP Update User Optins AJAX response : ",r),AEJSWP.removeSessionStorageItem("aejswp_initial_optin_choices");var a={cform_id:e,user_data:t,optins:o};AEJSWP.trackEvent("optinsUpdated",a)}}catch(e){console.log("AEJSWP Error: WP Update User Optins AJAX response : ",r)}}))}else AEJSWP.debugOutput("User optins not changed, so not making backend post")},AEJSWP.getUserUpdatedOptins=function(e,t){var r={},a=!1,o=AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0);null===o&&(AEJSWP.setOptinChoicesSessionStorage(),o=AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0));var i=AEJSWP.getLocalStorageItem("aejswp_first_optins_post_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_first_optins_post_completed",!0):[],s=(i[e],1!=i[e]);for(var n in s&&(AEJSWP.debugOutput("First time user has completed this form, marking all optins for this cform as changed"),a=!0,i[e]=!0,AEJSWP.setLocalStorageItem("aejswp_first_optins_post_completed",i,!0)),t)("undefined"==o[n]||t[n].user_choice!=o[n]||s)&&(a=!0,r[n]=t[n]);return!!a&&r},AEJSWP.getUserOptinChoices=function(e,t,r){(void 0===t||t)&&AEJSWP.restoreUserOptins(),AEJSWP.debugOutput("getUserOptinChoices : duplicate forms found : "+jQuery('form[id="ae-cform-email-reg-'+e+'"]').length),jQuery('form[id="ae-cform-email-reg-'+e+'"]').length>1&&(AEJSWP.debugOutput("getUserOptinChoices : found forms with the same id"),void 0!==r&&"undefined"!=r||null===localStorage.getItem("aejswp_cform_hash_sso")||(AEJSWP.debugOutput("getUserOptinChoices : hash is undefined but local storage SSO hash var exists - use that instead"),r=AEJSWP.getLocalStorageItem("aejswp_cform_hash_sso").replace(/"/g,"")));const a=void 0!==r?jQuery(`.${r}`):jQuery(`#ae-cform-modal-container-${e}:visible`).length>0?jQuery(`#ae-cform-modal-container-${e}`):jQuery(`#ae-cform-container-${e}`);var o=AEJSWP.custom_forms[e].opt_ins,i={};for(var s in o){let t=a.length>0?jQuery(a).find("#ac-cform-optin-checkbox-"+e+"-"+o[s].id):jQuery("#ac-cform-optin-checkbox-"+e+"-"+o[s].id);const r=t.is(":enabled"),n=t.is(":checked");let u="";1===t.data("email")?u="email":1===t.data("sms")&&(u="sms"),o[s].user_choice=r&&n,i[s]={optin_id:o[s].id,user_choice:o[s].user_choice,disabled:!r,type:u};let d=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);d||(d=[]),d[o[s].id]=o[s].user_choice,AEJSWP.setLocalStorageItem("aejswp_optin_choices",d,!0)}return AEJSWP.setLocalStorageItem("aejswp_cform_hash",r,!0),void 0!==r&&AEJSWP.setLocalStorageItem("aejswp_cform_hash_sso",r,!0),AEJSWP.debugOutput("getUserOptinChoices",i),i},AEJSWP.clearCustomFormState=function(e){doClearState=function(){AEJSWP.debugOutput("Custom Form flow ended, clearing state, immediate = "+e),AEJSWP.aeJS.settings.display_error_message=!0,AEJSWP.aeJS.settings.extra_fields_screen=AEJSWP.extra_fields_screen,AEJSWP.aeJS.settings.extra_fields=AEJSWP.extra_fields,AEJSWP.aeJS.settings.services=AEJSWP.services,AEJSWP.aeJS.settings.return_url=AEJSWP.getSessionStorageItem("aejswp_cform_prev_return_url")?AEJSWP.getSessionStorageItem("aejswp_cform_prev_return_url"):AEJSWP.aeJS.settings.return_url,AEJSWP.aeJS.settings.auth_window=AEJSWP.getSessionStorageItem("aejswp_cform_prev_auth_window")?AEJSWP.getSessionStorageItem("aejswp_cform_prev_auth_window"):AEJSWP.aeJS.settings.auth_window,AEJSWP.aeJS.settings.extra_fields=AEJSWP.getSessionStorageItem("aejswp_cform_prev_extra_fields")?AEJSWP.getSessionStorageItem("aejswp_cform_prev_extra_fields",!0):AEJSWP.aeJS.settings.auth_window,AEJSWP.removeLocalStorageItem("aejswp_cform_id"),AEJSWP.removeLocalStorageItem("aejswp_cform_hash"),AEJSWP.removeSessionStorageItem("aejswp_cform_prev_return_url"),AEJSWP.removeSessionStorageItem("aejswp_cform_prev_auth_window"),AEJSWP.removeSessionStorageItem("aejswp_cform_prev_extra_fields"),AEJSWP.removeSessionStorageItem("aejswp_user_cancelled_cform_modal_display"),AEJSWP.removeSessionStorageItem("aejswp_user_opened_cform_modal_display"),AEJSWP.removeSessionStorageItem("aejswp_verify_email_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_verify_email_sent"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_email"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_member_service_id"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open"),AEJSWP.removeSessionStorageItem("aejswp_user_casl_in_progress"),"undefined"!=typeof grecaptcha&&grecaptcha.reset()},AEJSWP.getLocalStorageItem("aejswp_cform_id")&&(e?doClearState():setTimeout(doClearState,1))},AEJSWP.displayPasswordResetEmailSent=function(){var e=AEJSWP.getLocalStorageItem("aejswp_cform_id");const t=AEJSWP.getLocalStorageItem("aejswp_cform_hash"),r=jQuery(`.${t}`);var a='<div class="ae-cform-pasword-reset-instruictions-inner">'+AEJSWP.custom_forms[e].flow_labels.reset_password_instructions_sent+"</div>";a+='<div class="ae-cform-form-links"><a href="#" class="ae-cform-reset-password-cancel-link" id="ae-cform-reset-password-cancel-link-'+e+'" href="#" data-ae-cform-id="'+e+'">',a+=AEJSWP.custom_forms[e].flow_labels.cancel_button,a+="</a></div>",jQuery("#ae-cform-reset-password-instruction-"+e).html(a),jQuery(r).find("#ae-cform-reset-password-submit-"+e).hide(),jQuery(r).find("#ae-cform-reset-password-email-"+e).hide(),jQuery(r).find("#ae-cform-reset-password-login-link-"+e).hide(),jQuery(r).find("#ae-cform-reset-password-register-link-"+e).hide(),jQuery(r).find(".ae-cform-reset-password-cancel-link").click((function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery(r).find("#ae-cform-email-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-title-"+t).slideDown(),jQuery(r).find("#ae-cform-signin-options-"+t).slideDown(),jQuery(r).find("#ae-cform-optins-container-"+t).slideDown(),AEJSWP.clearPasswordResetState()}))},AEJSWP.displayEnterNewPassword=function(){AEJSWP.debugOutput("Showing password reset step 2");var e=AEJSWP.getLocalStorageItem("aejswp_cform_id");jQuery("#ae-cform-email-container-"+e).hide(),jQuery("#ae-cform-title-"+e).hide(),jQuery("#ae-cform-signin-options-"+e).hide(),jQuery("#ae-cform-reset-password-step1-"+e).hide(),jQuery("#ae-cform-reset-password-login-link-"+e).hide(),jQuery("#ae-cform-reset-password-register-link-"+e).hide(),jQuery("#ae-cform-reset-password-step2-"+e).show(),jQuery("#ae-cform-reset-password-container-"+e).show(),jQuery("#ae-cform-optins-container-"+e).hide()},AEJSWP.displayPasswordResetSuccess=function(){AEJSWP.debugOutput("Showing password reset success");var e=AEJSWP.getLocalStorageItem("aejswp_cform_id");jQuery("#ae-cform-reset-password-step2-"+e).hide(),jQuery("#ae-cform-reset-password-step3-"+e).show(),jQuery("#ae-cform-reset-password-login-link-"+e).show()},AEJSWP.clearPasswordResetState=function(){AEJSWP.debugOutput("Clearing password reset state"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_email"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_member_service_id"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open")},AEJSWP.updateCaslLabels=function(e){e?(jQuery(".ae-cform-optin-label-non-casl").hide(),jQuery(".ae-cform-optin-terms-non-casl").hide(),jQuery(".ae-cform-optin-label-casl").show(),jQuery(".ae-cform-optin-terms-casl").show(),jQuery(".ae-cform-optin-checkbox").attr("checked",!1)):(jQuery(".ae-cform-optin-label-non-casl").show(),jQuery(".ae-cform-optin-terms-non-casl").show(),jQuery(".ae-cform-optin-label-casl").hide(),jQuery(".ae-cform-optin-terms-casl").hide())},AEJSWP.displayRegistrationForm=function(e,t){jQuery(`.ae-cform-container.${t}, .ae-cform-modal-container.${t}`).find("#ae-cform-email-login-container-"+e).slideToggle(),jQuery(`.ae-cform-container.${t}, .ae-cform-modal-container.${t}`).find("#ae-cform-email-reg-container-"+e).slideToggle();var r=AEJSWP.custom_forms[e].modal_display_cta;AEJSWP.trackEvent("registrationModalShown",r)},AEJSWP.hideCaptchaOnForm=function(e){AEJSWP.debugOutput("Hiding captcha field on form "+e),jQuery("#ae-cform-captcha-"+e).hide()},AEJSWP.captchaVerifyCallback=function(e,t){AEJSWP.debugOutput(`Google reCAPTCHA: Check form ${e} and hash ${t}`),void 0===AEJSWP.custom_forms[e].captcha_widget||AEJSWP.custom_forms[e].captchaVerified||(2==parseInt(AEJSWP.custom_forms[e].type_id)?(AEJSWP.debugOutput("Google reCAPTCHA completed, but deferring validation until form optins submitted"),AEJSWP.custom_forms[e].captchaVerified=!0,AEJSWP.customFormSubmit(AEJSWP.customFormEventFormID,AEJSWP.customFormEvent,t)):jQuery.ajax({url:AEJSWP.ajaxurl,method:"POST",type:"POST",dataType:"json",data:{action:AEJSWP.ajax_action_user_check_captcha,sitekey:AEJSWP.custom_forms[e].recaptcha_key,confirmcode:grecaptcha.getResponse(AEJSWP.custom_forms[e].captcha_widget),formid:e},success:function(t){AEJSWP.debugOutput("Google reCAPTCHA: Response "+t.success),1==t.success?(AEJSWP.debugOutput("Google reCAPTCHA: Custom form "+e+" validated"),AEJSWP.custom_forms[e].captchaVerified=!0):(AEJSWP.debugOutput("Google reCAPTCHA: failed (not validated)"),AEJSWP.custom_forms[e].captchaVerified=!1)},error:function(t,r,a){AEJSWP.debugOutput("Google reCAPTCHA: failed (AJAX Failed) "+r),AEJSWP.custom_forms[e].captchaVerified=!1}}))},AEJSWP.triggerCustomFormModal=function(e,t){var r=jQuery(`.ae-cform-modal-container.${t}`);if(r.length){r.modal();var a=AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0)?AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0):[];a[e]=!0,AEJSWP.setSessionStorageItem("aejswp_user_opened_cform_modal_display",a,!0);var o=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[];o[e]=!1,AEJSWP.setSessionStorageItem("aejswp_user_cancelled_cform_modal_display",o,!0),r.trigger("ae-modal-open");var i=AEJSWP.custom_forms[e].modal_display_cta;AEJSWP.trackEvent("loginModalShown",i),AEJSWP.updateCustomForms()}};var onCaptchaloadCallback=function(){AEJSWP.debugOutput("Google reCAPTCHA script loaded correctly."),AEJSWP.custom_forms.captchaLoadComplete=!0,"function"==typeof additionalCaptchaOnLoadCallback&&(AEJSWP.debugOutput("Developer callback initiated."),developerCaptchaWidget=additionalCaptchaOnLoadCallback());var e=jQuery(".ae-cform-container");AEJSWP.customFormRenderRecaptcha(e),jQuery("#g-recaptcha-response").attr("aria-hidden",!0),jQuery("#g-recaptcha-response").attr("aria-label","do not use"),jQuery("#g-recaptcha-response").attr("aria-readonly",!0)};"undefined"!=typeof grecaptcha&&void 0!==grecaptcha.render&&onCaptchaloadCallback(),AEJSWP.getCustomCTAFormID=function(e,t){void 0===t&&(t=jQuery(".ae-cform-container").first().attr("data-ae-cform-id"));var r=t,a=jQuery(e).attr("class");if(jQuery(e).attr("data-form-id"))r=jQuery(e).attr("data-form-id");else if(a.length&&a.includes("ae-form-id-")){var o=a.split(/\s+/);if(o.length)for(var i=0;i<o.length;i++)o[i].includes("ae-form-id-")&&(r=o[i].replace("ae-form-id-",""))}return r},AEJSWP.addCustomFormListeners=function(){jQuery(".ae-cform-social-link").on("click",(function(e){e.preventDefault(),AEJSWP.custom_form_complete=!1;const t=jQuery(this).parents("[data-ae-cform-id]"),r=jQuery(t).data("hash-selector");if(!t.length)return!1;const a=t.attr("data-ae-cform-id"),o=jQuery(t).find("#ae-cform-email-container-"+a);jQuery(this).hasClass("email")&&o.length&&o.find("form > *:not('.ae-cform-error-block')").show();var i=jQuery("#ae-cform-modal-container-"+a);if("none"===i.css("display")&&i.find(".ae-cform-social-link:not(.email)").each((function(){jQuery(this).addClass("ae-cform-social-disabled")})),jQuery(this).hasClass("ae-cform-social-disabled")){if(0===AEJSWP.getCheckedOptins(a,r).length){const e=jQuery(t).find("#ae-cform-email-reg-"+a),r=AEJSWP.custom_forms[a].flow_labels.form_error_incomplete_optins;return AEJSWP.debugOutput("Opt-ins not selected"),AEJSWP.setFormError(e,r),AEJSWP.fireFormErrorsEvent("mailinglist",[r]),o.length&&!o.is(":visible")&&(o.find("form > *:not('.ae-cform-error-block')").hide(),o.slideToggle()),!1}}return!0})),jQuery(".ae-cform-modal-container").each((function(){jQuery(this).data("hash-selector"),jQuery(this).attr("id");jQuery(this).on("ae-modal-open",(function(){var e=jQuery(".ae-cform-optin-terms a, .ae-cform-optins-container .ae-cform-optin-label, #terms, #sms-terms",jQuery(this));AEJSWP.setAutoColors(e)}))})),jQuery(".ae-custom-cta ").on("click",(function(e){e.preventDefault();var t=AEJSWP.getCustomCTAFormID(jQuery(this)),r=jQuery(this).data("hash-selector");void 0===r&&(r=jQuery("#ae-cform-modal-display-cta-"+t).data("hash-selector")),AEJSWP.triggerCustomFormModal(t,r)})),jQuery(".ae-cform-already-registered-link").click((function(e){e.preventDefault();const t=jQuery(this).parents(".ae-cform-container").length>0?jQuery(this).parents(".ae-cform-container"):jQuery(this).parents(".ae-cform-modal-container");var r=parseInt(jQuery(this).data("ae-cform-id"));jQuery(t).find("#ae-cform-email-login-container-"+r).slideToggle(),jQuery(t).find("#ae-cform-email-reg-container-"+r).slideToggle()})),jQuery(".ae-cform-not-registered-link").click((function(e){e.preventDefault();const t=jQuery(this).parents(".ae-cform-container").length>0?jQuery(this).parents(".ae-cform-container").data("hash-selector"):jQuery(this).parents(".ae-cform-modal-container").data("hash-selector");AEJSWP.displayRegistrationForm(parseInt(jQuery(this).data("ae-cform-id")),t)})),jQuery(".ae-cform-forgot-password-link").click((function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));const r=jQuery(this).parents(".ae-cform-container").length>0?jQuery(this).parents(".ae-cform-container"):jQuery(this).parents(".ae-cform-modal-container");jQuery(r).find("#ae-cform-email-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-title-"+t).slideUp(),jQuery(r).find("#ae-cform-signin-options-"+t).slideUp(),jQuery(r).find("#reset-password-email-"+t).val(jQuery("#ae-cform-input-login-email-"+t).val()),jQuery(r).find("#ae-cform-optins-container-"+t).slideUp()})),jQuery(".ae-cform-reset-password-login-link").click((function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));const r=jQuery(this).parents(".ae-cform-container").length>0?jQuery(this).parents(".ae-cform-container"):jQuery(this).parents(".ae-cform-modal-container");jQuery(r).find("#ae-cform-email-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-title-"+t).slideDown(),jQuery(r).find("#ae-cform-signin-options-"+t).slideDown(),jQuery(r).find("#ae-cform-optins-container-"+t).slideDown(),AEJSWP.clearPasswordResetState()})),jQuery(".ae-cform-reset-password-register-link").click((function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));const r=jQuery(this).parents(".ae-cform-container").length>0?jQuery(this).parents(".ae-cform-container"):jQuery(this).parents(".ae-cform-modal-container");jQuery(r).find("#ae-cform-email-login-container-"+t).hide(),jQuery(r).find("#ae-cform-email-reg-container-"+t).show(),jQuery(r).find("#ae-cform-email-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-title-"+t).slideDown(),jQuery(r).find("#ae-cform-signin-options-"+t).slideDown(),jQuery(r).find("#ae-cform-optins-container-"+t).slideDown(),AEJSWP.clearPasswordResetState()})),jQuery(".ae-cform-reset-password-cancel-link").click((function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));const r=jQuery(this).parents(".ae-cform-container").length>0?jQuery(this).parents(".ae-cform-container"):jQuery(this).parents(".ae-cform-modal-container");jQuery(r).find("#ae-cform-email-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery(r).find("#ae-cform-title-"+t).slideDown(),jQuery(r).find("#ae-cform-signin-options-"+t).slideDown(),jQuery(r).find("#ae-cform-optins-container-"+t).slideDown(),AEJSWP.clearPasswordResetState()})),jQuery(".ae-cform-verify-email-resend-link").click((function(e){e.preventDefault(),AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")&&AEJSWP.sendVerifyEmail(AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress"))})),jQuery(".ae-cform-verify-email-cancel-link").click((function(e){e.preventDefault(),AEJSWP.aeJS.trigger.logout(),AEJSWP.removeSessionStorageItem("aejswp_verify_email_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_verify_email_sent");var t=parseInt(jQuery(this).data("ae-cform-id"));const r=jQuery(this).parents(".ae-cform-container").length>0?jQuery(this).parents(".ae-cform-container"):jQuery(this).parents(".ae-cform-modal-container");jQuery(r).find("#ae-cform-verify-email-container-"+t).hide(),jQuery(r).find("#ae-cform-title-"+t).show(),jQuery(r).find("#ae-cform-signin-options-"+t).show(),jQuery(r).find("#ae-cform-email-container-"+t).show(),jQuery(r).find("#ae-cform-optins-container-"+t).show()})),jQuery(".ae-cform-reset-password-submit").click((function(e){AEJSWP.debugOutput("Password reset flow started"),e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));const r=jQuery(this).parents(".ae-cform-container").length>0?jQuery(this).parents(".ae-cform-container"):jQuery(this).parents(".ae-cform-modal-container"),a=jQuery(r).data("hash-selector");var o=jQuery(r).find("#reset-password-email-"+t).val();AEJSWP.applyCustomFormSettings(t,e,a),AEJSWP.setSessionStorageItem("aejswp_password_reset_in_progress",!0),AEJSWP.sendVerifyEmail(o,t)})),jQuery(".ae-cform-update-password-submit").click((function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));const r=jQuery(this).parents(".ae-cform-container").length>0?jQuery(this).parents(".ae-cform-container"):jQuery(this).parents(".ae-cform-modal-container");var a=jQuery(r).find("#reset-password-password-"+t).val();if(jQuery(r).find("#reset-password-password-"+t).parsley().validate(),jQuery(r).find("#reset-password-password-confirm-"+t).parsley().validate(),jQuery(r).find("#reset-password-password-"+t).parsley().isValid()&&jQuery(r).find("#reset-password-password-confirm-"+t).parsley().isValid()){var o=AEJSWP.getSessionStorageItem("aejswp_password_reset_email"),i=AEJSWP.getSessionStorageItem("aejswp_password_reset_member_service_id");AEJSWP.debugOutput("Updating user password for:"+o+", member_service_id "+i),AEJSWP.aeJS.trigger.reset_password(i,o,a)}})),jQuery(".ae-cform-optin-checkbox").length&&jQuery(".ae-cform-optin-checkbox").each((function(){if(!jQuery(this).is(":checked")){var e=jQuery(this).data("ae-cform-id"),t=parseInt(AEJSWP.custom_forms[e].type_id);AEJSWP.debugOutput("Optin "+jQuery(this).data("ae-cform-id")+" is not checked"),2==t&&AEJSWP.enableSignUpFormSubmitButtons(jQuery(this).data("ae-optin-id"),e,!1)}})),jQuery(".ae-cform-optin-checkbox").change((function(e){e.preventDefault();var t=jQuery(this).data("ae-cform-id");const r=jQuery(this).parents("[data-ae-cform-id][data-hash-selector]").data("hash-selector");e.originalEvent&&jQuery(this).removeAttr("data-pre-check");var a="string"==typeof jQuery(this).data("ae-optin-id")&&jQuery(this).data("ae-optin-id").indexOf("similar-artists")>0?"similar-artists":parseInt(jQuery(this).data("ae-optin-id"));if("similar-artists"!=a){AEJSWP.updateRelatedField(t,jQuery(this)),2==parseInt(AEJSWP.custom_forms[t].type_id)&&(AEJSWP.debugOutput("Optin "+jQuery(this).data("ae-optin-id")+" has been "+(jQuery(this).is(":checked")?"checked":"unchecked")),AEJSWP.enableSignUpFormSubmitButtons(jQuery(this).data("ae-optin-id"),t,jQuery(this).is(":checked"),r));var o=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);o||(o=[]),o[a]=jQuery(this).is(":checked"),AEJSWP.setLocalStorageItem("aejswp_optin_choices",o,!0),AEJSWP.setLocalStorageItem("aejswp_cform_hash",r,!0),void 0!==r&&AEJSWP.setLocalStorageItem("aejswp_cform_hash_sso",r,!0)}})),jQuery("input[name*='s_birthdate']").on("input",(function(){AEJSWP.updateDOB()})),jQuery("input[name='s_birthdate_day'],input[name='s_birthdate_month']").on("blur",(function(){var e=AEJSWP.padString(jQuery(this).val(),2);e!=jQuery(this).val()&&""!=jQuery(this).val()&&jQuery(this).val(e)})),jQuery(".ae-cform-input-country").change((function(){var e=jQuery(this).val(),t=parseInt(jQuery(this).data("ae-cform-id")),r="1"==AEJSWP.custom_forms[t].opt_ins_casl_enabled;if("CA"==e&&r){AEJSWP.debugOutput("CASL enabled & user selected Canada, updating opt-ins & terms for CASL compliance"),AEJSWP.updateCaslLabels(!0),AEJSWP.debugOutput("User completed CASL compliance flow, updating state");var a=AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0):[];a[t]=!0,AEJSWP.removeSessionStorageItem("aejswp_user_casl_in_progress"),AEJSWP.setLocalStorageItem("aejswp_user_casl_completed",a,!0)}"CA"!=e&&r&&(AEJSWP.debugOutput("CASL enabled, but user selected another country, updating opt-in terms for non-CASL"),AEJSWP.updateCaslLabels(!1)),AEJSWP.updateOptinChecks(t,e)})),jQuery(".ae-cform-modal-display-cta").click((function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));const r=jQuery(this).data("hash-selector");AEJSWP.triggerCustomFormModal(t,r)})),void 0!==jQuery.modal&&jQuery(".ae-cform-modal-container").on(jQuery.modal.OPEN,(function(e,t){jQuery(".close-modal").click((function(){AEJSWP.debugOutput("Modal closed by user");var e=AEJSWP.getLocalStorageItem("aejswp_cform_id");if(e){AEJSWP.debugOutput("storing the closure in session storage to avoid re-popping the modal up to the user on page refresh");var t=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[];t[e]=!0,AEJSWP.setSessionStorageItem("aejswp_user_cancelled_cform_modal_display",t,!0)}}))}))},AEJSWP.updateOptinChecks=function(e,t){const r=["US","UM"],a=jQuery('[data-ae-cform-id="'+e+'"]');a.length&&jQuery(".ae-cform-optin-checkbox",a).each((function(){jQuery(this).attr("data-pre-check")&&(r.includes(t)?jQuery(this).prop("checked","checked"):jQuery(this).prop("checked",!1),AEJSWP.updateRelatedField(e,jQuery(this)))}))},AEJSWP.updateRelatedField=function(e,t){const r=jQuery(t).is(":checked");var a=jQuery(t).data("ae-optin-related-field");const o=jQuery(t).parents(".ae-cform-container,.ae-cform-modal-container").data("hash-selector");if(void 0===a);else{var i=jQuery(`.${o}`).find("#ae-cform-reg-item-"+a+"-"+e);let t=void 0!==AEJSWP.custom_forms[e].form_fields[a]&&"1"===Object.values(AEJSWP.custom_forms[e].form_fields[a])[0];if(jQuery(`.${o}`).find('[data-ae-optin-related-field="'+a+'"]:checked').length>0&&(t=!0),jQuery(`.${o}`).find('.ae-cform-input[name="'+a+'"]').attr("required",(function(e,a){return!(!r&&!t)&&"required"})),r||t)if(jQuery(i).find(".cform-required-field").length)jQuery(i).find("label div:first").removeClass("hidden").find("span:first").removeClass("hidden");else{const e=jQuery(i).find("label"),t=jQuery('<div class="cform-required-field"><span>* </span>'+e.html()+"</div>");jQuery(e).empty().append(t)}else jQuery(i).find("label div:first").addClass("hidden").find("span:first").addClass("hidden");var s="disabled"==i.attr("data-dynamic-field")?"enabled":"disabled";if("visible"==i.attr("data-dynamic-field-visibility")){var n=AEJSWP.custom_forms[e].form_fields[a];AEJSWP.custom_forms[e].form_fields[a][Object.keys(n)[0]]=0==Object.values(n)[0]?1:0,jQuery(i).attr("data-dynamic-field",s).find("label .cform-required-field").toggleClass("hidden").find("span:first").toggleClass("hidden")}else if("conditional"==i.attr("data-dynamic-field-visibility")){n=AEJSWP.custom_forms[e].form_fields[a];if(AEJSWP.custom_forms[e].form_fields[a][Object.keys(n)[0]]=0==Object.values(n)[0]?1:0,!i.is(":visible"))jQuery(i).show().attr("data-dynamic-field",s).find("label .cform-required-field").addClass("cform-required-field").find("span:first").removeClass("hidden"),"mobilephone"===a&&window.AEWPFrontEnd.addPaddingTelInput(e,o);else 0===jQuery('[data-ae-optin-related-field="'+a+'"]:checked').length&&jQuery(i).hide().attr("data-dynamic-field",s).find("label .cform-required-field").addClass("hidden").find("span:first").addClass("hidden")}}},AEJSWP.updateDOB=function(){var e=jQuery("input[name='s_birthdate_day']").val();void 0!==e&&e.length>0&&(e=AEJSWP.padString(e,2));var t=jQuery("input[name='s_birthdate_month']").val();void 0!==t&&t.length>0&&(t=AEJSWP.padString(t,2));jQuery("input[name='birthdate']").val("1900-"+t+"-"+e)},AEJSWP.setFormError=function(e,t){jQuery(".ae-cform-error-block",e).html(t).show()},AEJSWP.hideFormError=function(e){jQuery(".ae-cform-error-block",e).hide()},AEJSWP.enableSignUpFormSubmitButtons=function(e,t,r,a){const o=jQuery(`.ae-cform-modal-container[data-ae-cform-id="${t}"].${a}`);if(1==AEJSWP.custom_forms[t].block_signup_submit){if(1==parseInt(AEJSWP.custom_forms[t].modal_display))var i=jQuery(o).find(`.ae-cform-modal-container[data-ae-cform-id="${t}"]`);else i=jQuery(o).find(`.ae-cform-container[data-ae-cform-id="${t}"]`);jQuery("#ae-cform-optins-container-"+t).each((function(){jQuery(this).find(".ae-cform-optin-checkbox").each((function(){jQuery(this).is(":checked")&&jQuery(this).attr("id")!=e&&"number"==typeof jQuery(this).data("ae-optin-id")&&(r=!0)}))})),1==AEJSWP.vv_auto_post_enabled&&(AEJSWP.debugOutput("VV autopost enabled"),r=!0),1==r?(i.find(".ae-cform-item-submit-button > input").removeAttr("disabled"),i.find(".ae-cform-item-submit-button > input").removeClass("ae-cform-item-submit-button-disabled"),i.find(".ae-cform-social-link").each((function(){if(void 0!==jQuery(this).data("ae-cform-social-button-service-id")&&void 0!==jQuery(this).attr("onclickholder")){var e=jQuery(this).attr("onclickholder");jQuery(this).removeAttr("onclickholder"),jQuery(this).attr("onclick",e),jQuery(this).removeClass("ae-cform-item-social-button-disabled")}}))):(i.find(".ae-cform-item-submit-button > input").attr("disabled","disabled"),i.find(".ae-cform-item-submit-button > input").addClass("ae-cform-item-submit-button-disabled"),i.find(".ae-cform-social-link").each((function(){if(void 0!==jQuery(this).data("ae-cform-social-button-service-id")){var e=jQuery(this).attr("onclick");jQuery(this).removeAttr("onclick"),jQuery(this).attr("onclickholder",e),jQuery(this).addClass("ae-cform-item-social-button-disabled")}})))}else{const e=AEJSWP.getCheckedOptins(t,a);AEJSWP.setSocialSignupEnabled(e.length>0,t,a)}},AEJSWP.setSocialSignupEnabled=function(e,t,r){let a;if(void 0===r&&jQuery('form[id="ae-cform-email-reg-'+t+'"]').length>1)r=jQuery(`.ae-cform-container[data-ae-cform-id=${t}]:not(.-has-modal)`).data("hash-selector");if(1==parseInt(AEJSWP.custom_forms[t].modal_display)){if(void 0===r)r=jQuery(`#ae-cform-modal-container-${t}`).data("hash-selector");a=jQuery(`.ae-cform-modal-container[data-ae-cform-id="${t}"].${r}`)}else{if(void 0===r)r=jQuery(`#ae-cform-container-${t}`).data("hash-selector");a=jQuery(`.ae-cform-container[data-ae-cform-id="${t}"].${r}`).hasClass("-has-modal")?jQuery(`.ae-cform-modal-container[data-ae-cform-id="${t}"].${r}`):jQuery(`.ae-cform-container[data-ae-cform-id="${t}"].${r}`)}a.length&&a.find(".ae-cform-social-link:not(.email)").each((function(){if(e){if(void 0!==jQuery(this).data("ae-cform-social-button-service-id")&&void 0!==jQuery(this).attr("onclickholder")){var t=jQuery(this).attr("onclickholder");jQuery(this).removeAttr("onclickholder"),jQuery(this).attr("onclick",t),jQuery(this).removeClass("ae-cform-social-disabled")}}else if(void 0!==jQuery(this).data("ae-cform-social-button-service-id")){var r=jQuery(this).attr("onclick");jQuery(this).removeAttr("onclick"),jQuery(this).attr("onclickholder",r),jQuery(this).addClass("ae-cform-social-disabled")}}))},AEJSWP.getCheckedOptins=function(e,t){const r=[],a=AEJSWP.getUserOptinChoices(e,!1,t);if(a)for(const e in a){const t=a[e];t.user_choice&&(r[e]=t)}return r},AEJSWP.add_aejsready_handler=function(e){AEJSWP.debugOutput("Adding custom aejsready handler function : "+e),AEJSWP.aejsready_handlers.push(e)},AEJSWP.addMailingListFormCompleteCallback=function(e,t=10){AEJSWP.debugOutput("Adding custom mailing list form completed handler function : "+e),void 0===AEJSWP.mailingListFormCompletedCallbacks[t]&&(AEJSWP.mailingListFormCompletedCallbacks[t]=[]),AEJSWP.mailingListFormCompletedCallbacks[t].push(e)},AEJSWP.add_wait_for_event=function(e){AEJSWP.debugOutput("Adding event waiter: "+e),AEJSWP.event_waiters[e]=!1},AEJSWP.maybe_wait_for_event=function(e,t){AEJSWP.debugOutput("Maybe waiting for event : "+e),void 0===AEJSWP.event_waiters[e]||!1!==AEJSWP.event_waiters[e]?(AEJSWP.debugOutput("Wait not required, callback is ready for : "+e),t()):(AEJSWP.debugOutput("Waiting for callback : "+e),AEJSWP.event_waiters[e]=t)},AEJSWP.execute_wait_for_event=function(e){AEJSWP.debugOutput("Trying to executing event waiter : "+e),void 0!==AEJSWP.event_waiters[e]&&!1!==AEJSWP.event_waiters[e]?(AEJSWP.debugOutput("Event is ready to be executed: "+e),AEJSWP.event_waiters[e]()):(AEJSWP.debugOutput("Event not ready for execution so adding to waiting list: "+e),AEJSWP.event_waiters[e]=!0)},AEJSWP.add_data_filter=function(e,t){AEJSWP.debugOutput("Adding data filter: "+e),AEJSWP.data_filters[e]=t},AEJSWP.run_filter=function(e,t){return void 0!==AEJSWP.data_filters[e]?AEJSWP.data_filters[e](t):t},AEJSWP.logout=function(){AEJSWP.clearSessionStorage();var e=AEJSWP.user_logged_in?AEJSWP.ae_logout_url_bare+"&return_url="+AEJSWP.wp_logout_url:AEJSWP.ae_logout_url;AEJSWP.debugOutput("Logout. Redirecting to AE logout handler : "+e),window.location.href=e},AEJSWP.get_user_country=function(e){console.warn("Depricated function AEJSWP.get_user_country")},AEJSWP.triggerFrameworkFlow=function(){AEJSWP.detect_safari_incognito()||!AEJSWP.detect_cookies_enabled()?(jQuery("body").append('<div id="ae-browser-config-error" style="display:none;">'+(AEJSWP.detect_safari_incognito()?AEJSWP.safari_incognito_error:AEJSWP.cookies_disabled_error)+"</div>"),jQuery("#ae-browser-config-error").modal()):AEJSWP.aeJS.trigger.flow()},AEJSWP.add_url_param_to_return_url=function(e,t){void 0!==AEJSWP.return_url&&""!=AEJSWP.return_url||(AEJSWP.return_url=window.location.href),""==AEJSWP.getQueryStringValue(e)&&(AEJSWP.return_url=AEJSWP.addURLParameter(AEJSWP.return_url,e,t),AEJSWP.aeJS.settings.return_url=AEJSWP.return_url,void 0!==AEJSWP.login_redirect_url&&""!==AEJSWP.login_redirect_url&&(AEJSWP.login_redirect_url=AEJSWP.addURLParameter(AEJSWP.login_redirect_url,e,t)))},AEJSWP.add_url_param_to_return_url_parms=function(e,t){void 0!==AEJSWP.return_url&&""!==AEJSWP.return_url||(AEJSWP.return_url=window.location.href);var r=AEJSWP.getQueryString("return_url",AEJSWP.aeJS.settings.return_url);null!=(r=null===r?window.location.origin+window.location.pathname:decodeURIComponent(r))&&r.trim().length>0&&(r=AEJSWP.addURLParameter(r,e,t),AEJSWP.login_redirect_url.trim().length>0?(AEJSWP.login_redirect_url=AEJSWP.addURLParameter(AEJSWP.login_redirect_url,e,t),AEJSWP.aeJS.settings.login_redirect_url=AEJSWP.login_redirect_url):(AEJSWP.login_redirect_url=decodeURIComponent(r),AEJSWP.aeJS.settings.login_redirect_url=AEJSWP.login_redirect_url),AEJSWP.return_url=AEJSWP.queryStringUrlReplacement(AEJSWP.return_url,"return_url",encodeURIComponent(r)),AEJSWP.aeJS.settings.return_url=AEJSWP.return_url),AEJSWP.debugOutput("return url updated :"+AEJSWP.aeJS.settings.return_url),AEJSWP.hasOwnProperty("param_on_return_url_key")&&Array.isArray(AEJSWP.param_on_return_url_key)?(AEJSWP.param_on_return_url_key.push(e),AEJSWP.param_on_return_url_value.push(t)):(AEJSWP.param_on_return_url_key=[e],AEJSWP.param_on_return_url_value=[t]),AEJSWP.debugOutput("AEJSWP param_on_return_url_key updated :"+AEJSWP.param_on_return_url_key),AEJSWP.debugOutput("AEJSWP param_on_return_url_value updated :"+AEJSWP.param_on_return_url_value)},AEJSWP.remove_url_param_to_return_url_parms=function(e){void 0!==AEJSWP.return_url&&""!=AEJSWP.return_url||(AEJSWP.return_url=window.location.href);var t=decodeURIComponent(AEJSWP.getQueryString("return_url",AEJSWP.aeJS.settings.return_url));t.trim().length>0&&(t=AEJSWP.remove_url_parameter(t,e),AEJSWP.login_redirect_url.trim().length>0?(AEJSWP.login_redirect_url=AEJSWP.remove_url_parameter(decodeURIComponent(AEJSWP.login_redirect_url),e),AEJSWP.aeJS.settings.login_redirect_url=decodeURIComponent(AEJSWP.login_redirect_url)):(AEJSWP.login_redirect_url=decodeURIComponent(t),AEJSWP.aeJS.settings.login_redirect_url=AEJSWP.login_redirect_url),AEJSWP.return_url=AEJSWP.queryStringUrlReplacement(AEJSWP.return_url,"return_url",encodeURIComponent(AEJSWP.remove_url_parameter(decodeURIComponent(t),e))),AEJSWP.aeJS.settings.return_url=AEJSWP.return_url)},AEJSWP.remove_url_parameter=function(e,t){var r=e.split("?");if(r.length>=2){for(var a=encodeURIComponent(t)+"=",o=r[1].split(/[&;]/g),i=o.length;i-- >0;)-1!==o[i].lastIndexOf(a,0)&&o.splice(i,1);return e=r[0]+(o.length>0?"?"+o.join("&"):"")}return e},AEJSWP.queryStringUrlReplacement=function(e,t,r){var a,o,i=new RegExp("[\\?&]"+t+"=([^&#]*)","i"),s=i.exec(e);null===s?o=e+(a=/\?/.test(e)?"&":"?")+t+"="+r:(a=s[0].charAt(0),o=e.replace(i,a+t+"="+r));return o},AEJSWP.getQueryString=function(e,t){var r=t||window.location.href,a=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(r);return a?a[1]:null},AEJSWP.resumeLoginRedirect=function(){void 0!==AEJSWP.paused_redirect_url&&(window.location.href=AEJSWP.paused_redirect_url)};
